<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zombie Shooter 3D</title>
    <style>
        /* ========== –ë–ê–ó–û–í–´–ï –°–¢–ò–õ–ò ========== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            overflow: hidden;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #000;
        }

        #gameCanvas {
            display: block;
        }

        /* ========== –≠–ö–†–ê–ù –ë–õ–û–ö–ò–†–û–í–ö–ò –£–ö–ê–ó–ê–¢–ï–õ–Ø ========== */
        #lockScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            color: white;
        }

        #lockScreen h1 {
            font-size: 48px;
            margin-bottom: 20px;
            text-shadow: 0 0 20px #ff4444;
        }

        #lockScreen p {
            font-size: 18px;
            margin-bottom: 30px;
            color: #aaa;
        }

        #lockScreen button {
            padding: 15px 40px;
            font-size: 20px;
            background: linear-gradient(135deg, #ff4444, #cc0000);
            border: none;
            color: white;
            cursor: pointer;
            border-radius: 10px;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        #lockScreen button:hover {
            transform: scale(1.05);
            box-shadow: 0 0 30px rgba(255, 68, 68, 0.5);
        }

        /* ========== –ü–†–ò–¶–ï–õ ========== */
        #crosshair {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
            z-index: 100;
        }

        #crosshair::before,
        #crosshair::after {
            content: '';
            position: absolute;
            background: white;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
        }

        #crosshair::before {
            width: 20px;
            height: 2px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        #crosshair::after {
            width: 2px;
            height: 20px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        /* ========== –ü–ê–ù–ï–õ–¨ –£–ü–†–ê–í–õ–ï–ù–ò–Ø ========== */
        #controlsPanel {
            position: fixed;
            top: 15px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            padding: 10px 20px;
            border-radius: 10px;
            color: white;
            font-size: 14px;
            z-index: 100;
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .control-key {
            background: linear-gradient(135deg, #4a4a4a, #2a2a2a);
            padding: 4px 10px;
            border-radius: 5px;
            font-weight: bold;
            border: 1px solid #666;
            margin-right: 5px;
            font-size: 12px;
        }

        /* ========== HUD ========== */
        #hud {
            position: fixed;
            top: 70px;
            left: 20px;
            color: white;
            z-index: 100;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
        }

        .hud-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            font-size: 18px;
            background: rgba(0, 0, 0, 0.5);
            padding: 8px 15px;
            border-radius: 5px;
        }

        .hud-icon {
            width: 24px;
            height: 24px;
            margin-right: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #coins .hud-icon { color: gold; }
        #armor .hud-icon { color: #4a90d9; }
        #ammo .hud-icon { color: #ff6b35; }
        #kills .hud-icon { color: #ff4444; }

        /* ========== –ü–û–õ–û–°–ö–ò –ó–î–û–†–û–í–¨–Ø –ò –ë–†–û–ù–ò ========== */
        .hud-bar-container {
            margin-top: 10px;
        }

        .hud-bar {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            background: rgba(0, 0, 0, 0.5);
            padding: 6px 10px;
            border-radius: 5px;
        }

        .hud-bar-icon {
            width: 24px;
            margin-right: 8px;
            font-size: 16px;
        }

        .hud-bar-bg {
            width: 120px;
            height: 16px;
            background: rgba(0, 0, 0, 0.6);
            border-radius: 3px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .hud-bar-fill {
            height: 100%;
            transition: width 0.3s ease;
            border-radius: 2px;
        }

        .health-fill {
            background: linear-gradient(to bottom, #ff6b6b, #ee5a5a);
            box-shadow: 0 0 10px rgba(255, 100, 100, 0.5);
        }

        .armor-fill {
            background: linear-gradient(to bottom, #4a90d9, #357abd);
            box-shadow: 0 0 10px rgba(74, 144, 217, 0.5);
        }

        .hud-bar-text {
            margin-left: 10px;
            font-size: 14px;
            font-weight: bold;
            min-width: 30px;
        }

        /* ========== –ö–ù–û–ü–ö–ê –ú–ê–ì–ê–ó–ò–ù–ê ========== */
        #shopButton {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #4a90d9, #357abd);
            border: 2px solid #5fa8f5;
            color: white;
            padding: 12px 20px;
            font-size: 16px;
            border-radius: 10px;
            cursor: pointer;
            z-index: 100;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 15px rgba(74, 144, 217, 0.3);
        }

        #shopButton:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(74, 144, 217, 0.5);
        }

        #shopButton .key-hint {
            background: rgba(0, 0, 0, 0.3);
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 12px;
        }

        /* ========== –ò–ù–í–ï–ù–¢–ê–†–¨ ========== */
        #inventory {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 5px;
            z-index: 100;
        }

        .inv-slot {
            width: 60px;
            height: 60px;
            background: rgba(0, 0, 0, 0.6);
            border: 2px solid #555;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            position: relative;
        }

        .inv-slot.active {
            border-color: #ffcc00;
            box-shadow: 0 0 15px rgba(255, 204, 0, 0.5);
        }

        .inv-slot .slot-num {
            position: absolute;
            top: 2px;
            left: 5px;
            font-size: 10px;
            color: #888;
        }

        .inv-slot .item-icon {
            font-size: 24px;
        }

        /* ========== –ú–ê–ì–ê–ó–ò–ù ========== */
        #shop {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(145deg, #0d0d0d, #1a1a1a);
            border: 2px solid #333;
            border-radius: 20px;
            padding: 0;
            z-index: 200;
            display: none;
            min-width: 420px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8),
                        0 0 40px rgba(0, 0, 0, 0.5),
                        inset 0 1px 0 rgba(255, 255, 255, 0.05);
            overflow: hidden;
        }

        #shop.visible {
            display: block;
            animation: shopOpen 0.3s ease-out;
        }

        @keyframes shopOpen {
            from { transform: translate(-50%, -50%) scale(0.9); opacity: 0; }
            to { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }

        .shop-header {
            background: linear-gradient(180deg, #1f1f1f, #141414);
            padding: 20px 30px;
            border-bottom: 1px solid #2a2a2a;
            position: relative;
        }

        #shop h2 {
            color: #e0e0e0;
            text-align: center;
            margin: 0;
            font-size: 22px;
            text-transform: uppercase;
            letter-spacing: 4px;
            font-weight: 600;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }

        .shop-content {
            padding: 20px;
        }

        .shop-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(180deg, #1a1a1a, #141414);
            padding: 15px 18px;
            margin-bottom: 12px;
            border-radius: 12px;
            border: 1px solid #2a2a2a;
            transition: all 0.2s ease;
        }

        .shop-item:hover {
            background: linear-gradient(180deg, #222, #1a1a1a);
            border-color: #3a3a3a;
            transform: translateX(5px);
        }

        .shop-item-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .shop-item-icon {
            font-size: 32px;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(145deg, #252525, #1a1a1a);
            border-radius: 10px;
            border: 1px solid #333;
        }

        .shop-item-name {
            color: #fff;
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 3px;
        }

        .shop-item-desc {
            color: #666;
            font-size: 11px;
            letter-spacing: 0.5px;
        }

        .shop-item-price {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .price-tag {
            color: #ffd700;
            font-weight: 700;
            font-size: 18px;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
        }

        .shop-btn {
            padding: 10px 22px;
            background: linear-gradient(180deg, #2d2d2d, #1f1f1f);
            border: 1px solid #444;
            color: #ccc;
            cursor: pointer;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.2s ease;
        }

        .shop-btn:hover {
            background: linear-gradient(180deg, #3a3a3a, #2a2a2a);
            border-color: #555;
            color: #fff;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .shop-btn:active {
            transform: scale(0.97);
        }

        .shop-btn:disabled {
            background: #1a1a1a;
            border-color: #222;
            color: #444;
            cursor: not-allowed;
        }

        #shop-close {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            color: #555;
            font-size: 20px;
            cursor: pointer;
            transition: color 0.2s;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        #shop-close:hover {
            color: #fff;
            background: rgba(255, 255, 255, 0.1);
        }

        .shop-footer {
            background: #0d0d0d;
            padding: 12px;
            border-top: 1px solid #1a1a1a;
        }

        .shop-hint {
            text-align: center;
            color: #444;
            font-size: 11px;
            margin: 0;
            letter-spacing: 1px;
        }

        /* ========== –°–û–û–ë–©–ï–ù–ò–Ø ========== */
        #message {
            position: fixed;
            top: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px 30px;
            border-radius: 10px;
            z-index: 150;
            display: none;
            font-size: 18px;
        }

        #message.visible {
            display: block;
            animation: fadeOut 2s forwards;
        }

        @keyframes fadeOut {
            0% { opacity: 1; }
            70% { opacity: 1; }
            100% { opacity: 0; }
        }

        /* ========== –ò–ì–†–ê –û–ö–û–ù–ß–ï–ù–ê ========== */
        #gameOver {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 300;
            color: white;
        }

        #gameOver.visible {
            display: flex;
        }

        #gameOver h1 {
            font-size: 64px;
            color: #ff4444;
            margin-bottom: 20px;
        }

        #gameOver p {
            font-size: 24px;
            margin-bottom: 30px;
        }

        #gameOver button {
            padding: 15px 40px;
            font-size: 20px;
            background: linear-gradient(135deg, #4a90d9, #357abd);
            border: none;
            color: white;
            cursor: pointer;
            border-radius: 10px;
        }
    </style>
</head>
<body>
    <!-- –≠–∫—Ä–∞–Ω –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —É–∫–∞–∑–∞—Ç–µ–ª—è -->
    <div id="lockScreen">
        <h1>üßü ZOMBIE SHOOTER</h1>
        <p>WASD/–°—Ç—Ä–µ–ª–∫–∏ - –¥–≤–∏–∂–µ–Ω–∏–µ | –ü—Ä–æ–±–µ–ª - –ø—Ä—ã–∂–æ–∫ | –õ–ö–ú - —Å—Ç—Ä–µ–ª—å–±–∞ | B - –º–∞–≥–∞–∑–∏–Ω | V - –∫–∞–º–µ—Ä–∞</p>
        <button id="startBtn">–ù–ê–ß–ê–¢–¨ –ò–ì–†–£</button>
    </div>

    <!-- –ü—Ä–∏—Ü–µ–ª -->
    <div id="crosshair"></div>

    <!-- –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–≤–µ—Ä—Ö—É -->
    <div id="controlsPanel">
        <span class="control-key">WASD</span> –î–≤–∏–∂–µ–Ω–∏–µ
        <span class="control-key">–õ–ö–ú</span> –°—Ç—Ä–µ–ª—å–±–∞
        <span class="control-key">1</span><span class="control-key">2</span> –û—Ä—É–∂–∏–µ
        <span class="control-key">B</span> –ú–∞–≥–∞–∑–∏–Ω
        <span class="control-key">V</span> –ö–∞–º–µ—Ä–∞
    </div>

    <!-- HUD -->
    <div id="hud">
        <div class="hud-item" id="coins">
            <div class="hud-icon">ü™ô</div>
            <span id="coinsValue">0</span>
        </div>
        <div class="hud-item" id="ammo">
            <div class="hud-icon">üî´</div>
            <span id="ammoValue">12/12</span>
        </div>
        <div class="hud-item" id="kills">
            <div class="hud-icon">üíÄ</div>
            <span id="killsValue">0</span>
        </div>
        <!-- –ó–¥–æ—Ä–æ–≤—å–µ –∏ –±—Ä–æ–Ω—è —Å –ø–æ–ª–æ—Å–∫–∞–º–∏ -->
        <div class="hud-bar-container">
            <div class="hud-bar" id="healthBar">
                <div class="hud-bar-icon">‚ù§Ô∏è</div>
                <div class="hud-bar-bg">
                    <div class="hud-bar-fill health-fill" id="healthFill"></div>
                </div>
                <span class="hud-bar-text" id="healthValue">100</span>
            </div>
            <div class="hud-bar" id="armorBar" style="display: none;">
                <div class="hud-bar-icon">üõ°Ô∏è</div>
                <div class="hud-bar-bg">
                    <div class="hud-bar-fill armor-fill" id="armorFill"></div>
                </div>
                <span class="hud-bar-text" id="armorValue">0</span>
            </div>
        </div>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∞ –º–∞–≥–∞–∑–∏–Ω–∞ -->
    <button id="shopButton" onclick="toggleShop()">
        üè™ –ú–∞–≥–∞–∑–∏–Ω <span class="key-hint">B</span>
    </button>

    <!-- –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å -->
    <div id="inventory">
        <div class="inv-slot active" id="slot1" onclick="switchWeapon('pistol')">
            <span class="slot-num">1</span>
            <span class="item-icon">üî´</span>
            <span>–ü–∏—Å—Ç–æ–ª–µ—Ç</span>
        </div>
        <div class="inv-slot" id="slot2" onclick="switchWeapon('shotgun')">
            <span class="slot-num">2</span>
            <span class="item-icon" id="shotgunIcon" style="opacity: 0.3">üí•</span>
            <span id="shotgunName" style="opacity: 0.3">–î—Ä–æ–±–æ–≤–∏–∫</span>
        </div>
        <div class="inv-slot">
            <span class="slot-num">3</span>
        </div>
        <div class="inv-slot">
            <span class="slot-num">4</span>
        </div>
        <div class="inv-slot">
            <span class="slot-num">5</span>
        </div>
    </div>

    <!-- –ú–∞–≥–∞–∑–∏–Ω -->
    <div id="shop">
        <div class="shop-header">
            <button id="shop-close">‚úï</button>
            <h2>–ú–ê–ì–ê–ó–ò–ù</h2>
        </div>
        <div class="shop-content">
            <div class="shop-item" data-item="shotgun">
                <div class="shop-item-info">
                    <span class="shop-item-icon">üî´</span>
                    <div>
                        <div class="shop-item-name">–î—Ä–æ–±–æ–≤–∏–∫</div>
                        <div class="shop-item-desc">–ú–æ—â–Ω–æ–µ –æ—Ä—É–∂–∏–µ ‚Ä¢ 6 –ø–∞—Ç—Ä–æ–Ω–æ–≤ ‚Ä¢ –ö–ª–∞–≤–∏—à–∞ 2</div>
                    </div>
                </div>
                <div class="shop-item-price">
                    <span class="price-tag">50 ü™ô</span>
                    <button class="shop-btn" onclick="buyItem('shotgun')">–ö—É–ø–∏—Ç—å</button>
                </div>
            </div>
            <div class="shop-item" data-item="armor1">
                <div class="shop-item-info">
                    <span class="shop-item-icon">üëî</span>
                    <div>
                        <div class="shop-item-name">–ö–∞–º—É—Ñ–ª—è–∂</div>
                        <div class="shop-item-desc">–í–æ–µ–Ω–Ω–∞—è —Ñ–æ—Ä–º–∞ ‚Ä¢ +25 –±—Ä–æ–Ω–∏ ‚Ä¢ +25 HP</div>
                    </div>
                </div>
                <div class="shop-item-price">
                    <span class="price-tag">50 ü™ô</span>
                    <button class="shop-btn" onclick="buyItem('armor1')">–ö—É–ø–∏—Ç—å</button>
                </div>
            </div>
            <div class="shop-item" data-item="armor2">
                <div class="shop-item-info">
                    <span class="shop-item-icon">ü¶∫</span>
                    <div>
                        <div class="shop-item-name">–ñ–∏–ª–µ—Ç</div>
                        <div class="shop-item-desc">–†–∞–∑–≥—Ä—É–∑–∫–∞ ‚Ä¢ +50 –±—Ä–æ–Ω–∏ ‚Ä¢ +50 HP</div>
                    </div>
                </div>
                <div class="shop-item-price">
                    <span class="price-tag">100 ü™ô</span>
                    <button class="shop-btn" onclick="buyItem('armor2')">–ö—É–ø–∏—Ç—å</button>
                </div>
            </div>
            <div class="shop-item" data-item="armor3">
                <div class="shop-item-info">
                    <span class="shop-item-icon">ü™ñ</span>
                    <div>
                        <div class="shop-item-name">–®—Ç—É—Ä–º–æ–≤–æ–π –∫–æ–º–ø–ª–µ–∫—Ç</div>
                        <div class="shop-item-desc">–ü–æ–ª–Ω–∞—è —ç–∫–∏–ø–∏—Ä–æ–≤–∫–∞ ‚Ä¢ +100 –±—Ä–æ–Ω–∏ ‚Ä¢ +100 HP</div>
                    </div>
                </div>
                <div class="shop-item-price">
                    <span class="price-tag">500 ü™ô</span>
                    <button class="shop-btn" onclick="buyItem('armor3')">–ö—É–ø–∏—Ç—å</button>
                </div>
            </div>
            <div class="shop-item" data-item="ammo">
                <div class="shop-item-info">
                    <span class="shop-item-icon">üîπ</span>
                    <div>
                        <div class="shop-item-name">–ü–∞—Ç—Ä–æ–Ω—ã (–ø–∏—Å—Ç–æ–ª–µ—Ç)</div>
                        <div class="shop-item-desc">–ü–µ—Ä–µ–∑–∞—Ä—è–¥–∫–∞ –º–∞–≥–∞–∑–∏–Ω–∞ ‚Ä¢ 12 —à—Ç</div>
                    </div>
                </div>
                <div class="shop-item-price">
                    <span class="price-tag">14 ü™ô</span>
                    <button class="shop-btn" onclick="buyItem('ammo')">–ö—É–ø–∏—Ç—å</button>
                </div>
            </div>
            <div class="shop-item" data-item="shotgunAmmo">
                <div class="shop-item-info">
                    <span class="shop-item-icon">üî∏</span>
                    <div>
                        <div class="shop-item-name">–ü–∞—Ç—Ä–æ–Ω—ã (–¥—Ä–æ–±–æ–≤–∏–∫)</div>
                        <div class="shop-item-desc">–ü–µ—Ä–µ–∑–∞—Ä—è–¥–∫–∞ –º–∞–≥–∞–∑–∏–Ω–∞ ‚Ä¢ 6 —à—Ç</div>
                    </div>
                </div>
                <div class="shop-item-price">
                    <span class="price-tag">20 ü™ô</span>
                    <button class="shop-btn" onclick="buyItem('shotgunAmmo')">–ö—É–ø–∏—Ç—å</button>
                </div>
            </div>
        </div>
        <div class="shop-footer">
            <div class="shop-hint">B –∏–ª–∏ ESC ‚Äî –∑–∞–∫—Ä—ã—Ç—å</div>
        </div>
    </div>

    <!-- –°–æ–æ–±—â–µ–Ω–∏–µ -->
    <div id="message"></div>

    <!-- –≠–∫—Ä–∞–Ω —Å–º–µ—Ä—Ç–∏ -->
    <div id="gameOver">
        <h1>GAME OVER</h1>
        <p>–£–±–∏—Ç–æ –∑–æ–º–±–∏: <span id="finalKills">0</span></p>
        <button onclick="restartGame()">–ò–ì–†–ê–¢–¨ –°–ù–û–í–ê</button>
    </div>

    <!-- Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <script>
        // ========== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ==========
        let scene, camera, renderer;
        let player, playerBody = {};
        let zombies = [];
        let buildings = [];
        let clock = new THREE.Clock();

        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
        let gameState = {
            coins: 0,
            ammo: 12,
            maxAmmo: 12,
            shotgunAmmo: 0,
            maxShotgunAmmo: 6,
            currentWeapon: 'pistol', // 'pistol' –∏–ª–∏ 'shotgun'
            hasShotgun: false,
            kills: 0,
            health: 100,
            maxHealth: 100,
            armorHealth: 0,      // –¢–µ–∫—É—â–µ–µ –∑–¥–æ—Ä–æ–≤—å–µ –±—Ä–æ–Ω–∏
            maxArmorHealth: 0,   // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ –±—Ä–æ–Ω–∏
            armorType: 0,        // 0 - –Ω–µ—Ç, 1 - –æ–±—ã—á–Ω–∞—è, 2 - —Å—Ä–µ–¥–Ω—è—è, 3 - —Ç—è–∂—ë–ª–∞—è
            isPlaying: false,
            shopOpen: false
        };

        // –ú–∞—Å—Å–∏–≤ –¥–ª—è –∫—É—Å–∫–æ–≤ –º—è—Å–∞ –∏ –∫—Ä–æ–≤–∏
        let goreObjects = [];

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (WASD + —Å—Ç—Ä–µ–ª–∫–∏)
        let keys = {
            w: false, a: false, s: false, d: false, space: false,
            arrowup: false, arrowdown: false, arrowleft: false, arrowright: false
        };
        let mouseX = 0, mouseY = 0;
        let playerRotationY = 0;
        let cameraPitch = 0;

        // –†–µ–∂–∏–º –∫–∞–º–µ—Ä—ã: 'third' - –æ—Ç —Ç—Ä–µ—Ç—å–µ–≥–æ –ª–∏—Ü–∞, 'first' - –æ—Ç –ø–µ—Ä–≤–æ–≥–æ –ª–∏—Ü–∞
        let cameraMode = 'third';

        // –§–∏–∑–∏–∫–∞ –∏–≥—Ä–æ–∫–∞
        let playerVelocityY = 0;
        let isGrounded = true;
        const GRAVITY = -25;
        const JUMP_FORCE = 10;
        const PLAYER_SPEED = 8;
        const PLAYER_HEIGHT = 2.5;

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–æ–º–±–∏
        const ZOMBIE_SPEED = 2;
        const SPAWN_INTERVAL = 3000;
        const ZOMBIE_DAMAGE = 10;

        // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –°–¶–ï–ù–´ ==========
        function init() {
            // –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ü–µ–Ω—ã
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x87CEEB); // –ù–µ–±–æ
            scene.fog = new THREE.Fog(0x87CEEB, 50, 150);

            // –ö–∞–º–µ—Ä–∞
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);

            // –†–µ–Ω–¥–µ—Ä–µ—Ä
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            document.body.appendChild(renderer.domElement);
            renderer.domElement.id = 'gameCanvas';

            // –û—Å–≤–µ—â–µ–Ω–∏–µ
            setupLighting();

            // –ó–µ–º–ª—è
            createGround();

            // –ó–¥–∞–Ω–∏—è –∏ –∑–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è
            createBuildings();

            // –ò–≥—Ä–æ–∫
            createPlayer();

            // –°–æ–±—ã—Ç–∏—è
            setupEventListeners();

            // –ó–∞–ø—É—Å–∫ —Å–ø–∞–≤–Ω–∞ –∑–æ–º–±–∏
            setInterval(spawnZombie, SPAWN_INTERVAL);

            // –ê–Ω–∏–º–∞—Ü–∏—è
            animate();
        }

        // ========== –û–°–í–ï–©–ï–ù–ò–ï ==========
        function setupLighting() {
            // –°–æ–ª–Ω–µ—á–Ω—ã–π —Å–≤–µ—Ç
            const sunLight = new THREE.DirectionalLight(0xffffff, 1);
            sunLight.position.set(50, 100, 50);
            sunLight.castShadow = true;
            sunLight.shadow.mapSize.width = 2048;
            sunLight.shadow.mapSize.height = 2048;
            sunLight.shadow.camera.near = 0.5;
            sunLight.shadow.camera.far = 500;
            sunLight.shadow.camera.left = -100;
            sunLight.shadow.camera.right = 100;
            sunLight.shadow.camera.top = 100;
            sunLight.shadow.camera.bottom = -100;
            scene.add(sunLight);

            // Ambient —Å–≤–µ—Ç
            const ambientLight = new THREE.AmbientLight(0x404040, 0.5);
            scene.add(ambientLight);

            // Hemisphere —Å–≤–µ—Ç –¥–ª—è –±–æ–ª–µ–µ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ–≥–æ –æ—Å–≤–µ—â–µ–Ω–∏—è
            const hemiLight = new THREE.HemisphereLight(0x87CEEB, 0x556B2F, 0.3);
            scene.add(hemiLight);
        }

        // ========== –ó–ï–ú–õ–Ø ==========
        function createGround() {
            const groundGeometry = new THREE.PlaneGeometry(200, 200);
            const groundMaterial = new THREE.MeshStandardMaterial({
                color: 0x556B2F, // –¢—ë–º–Ω–æ-–∑–µ–ª—ë–Ω—ã–π (—Ö–∞–∫–∏)
                roughness: 0.8
            });
            const ground = new THREE.Mesh(groundGeometry, groundMaterial);
            ground.rotation.x = -Math.PI / 2;
            ground.receiveShadow = true;
            scene.add(ground);
        }

        // ========== –ó–î–ê–ù–ò–Ø –ò –ó–ê–ì–†–ê–ñ–î–ï–ù–ò–Ø ==========
        function createBuildings() {
            const buildingMaterial = new THREE.MeshStandardMaterial({ color: 0x8B4513 }); // –ö–æ—Ä–∏—á–Ω–µ–≤—ã–π
            const roofMaterial = new THREE.MeshStandardMaterial({ color: 0x654321 });
            const barrierMaterial = new THREE.MeshStandardMaterial({ color: 0x808080 });

            // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –¥–æ–º–æ–≤
            const housePositions = [
                { x: -30, z: -30 },
                { x: 30, z: -20 },
                { x: -25, z: 25 },
                { x: 35, z: 35 },
                { x: 0, z: -40 }
            ];

            housePositions.forEach(pos => {
                createHouse(pos.x, pos.z, buildingMaterial, roofMaterial);
            });

            // –ó–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è (—Å—Ç–µ–Ω—ã)
            const barrierPositions = [
                { x: 10, z: 10, rotY: 0, width: 8 },
                { x: -15, z: 5, rotY: Math.PI / 4, width: 6 },
                { x: 20, z: -10, rotY: Math.PI / 2, width: 10 },
                { x: -40, z: 0, rotY: 0, width: 12 },
                { x: 45, z: 10, rotY: Math.PI / 3, width: 8 }
            ];

            barrierPositions.forEach(bar => {
                createBarrier(bar.x, bar.z, bar.rotY, bar.width, barrierMaterial);
            });
        }

        function createHouse(x, z, wallMat, roofMat) {
            const houseGroup = new THREE.Group();

            // –°—Ç–µ–Ω—ã (–∫—É–±)
            const wallsGeo = new THREE.BoxGeometry(10, 6, 10);
            const walls = new THREE.Mesh(wallsGeo, wallMat);
            walls.position.y = 3;
            walls.castShadow = true;
            walls.receiveShadow = true;
            houseGroup.add(walls);

            // –ö—Ä—ã—à–∞ (–ø–∏—Ä–∞–º–∏–¥–∞ –∏–∑ –∫—É–±–æ–≤)
            const roofGeo = new THREE.BoxGeometry(12, 2, 12);
            const roof = new THREE.Mesh(roofGeo, roofMat);
            roof.position.y = 7;
            roof.castShadow = true;
            houseGroup.add(roof);

            const roofTop = new THREE.BoxGeometry(8, 2, 8);
            const roofT = new THREE.Mesh(roofTop, roofMat);
            roofT.position.y = 9;
            roofT.castShadow = true;
            houseGroup.add(roofT);

            houseGroup.position.set(x, 0, z);
            scene.add(houseGroup);

            // –î–æ–±–∞–≤–ª—è–µ–º –≤ —Å–ø–∏—Å–æ–∫ –∑–¥–∞–Ω–∏–π –¥–ª—è –∫–æ–ª–ª–∏–∑–∏–π
            buildings.push({
                minX: x - 6,
                maxX: x + 6,
                minZ: z - 6,
                maxZ: z + 6
            });
        }

        function createBarrier(x, z, rotY, width, mat) {
            const barrierGeo = new THREE.BoxGeometry(width, 3, 1);
            const barrier = new THREE.Mesh(barrierGeo, mat);
            barrier.position.set(x, 1.5, z);
            barrier.rotation.y = rotY;
            barrier.castShadow = true;
            barrier.receiveShadow = true;
            scene.add(barrier);

            // –†–∞—Å—á—ë—Ç —Ç–æ—á–Ω—ã—Ö –≥—Ä–∞–Ω–∏—Ü AABB —Å —É—á—ë—Ç–æ–º –ø–æ–≤–æ—Ä–æ—Ç–∞
            // –ë–∞—Ä—å–µ—Ä –∏–º–µ–µ—Ç —Ä–∞–∑–º–µ—Ä—ã: width –ø–æ X, depth=1 –ø–æ Z
            const halfWidth = width / 2;
            const halfDepth = 0.5; // –≥–ª—É–±–∏–Ω–∞ —Å—Ç–µ–Ω—ã = 1, –ø–æ–ª–æ–≤–∏–Ω–∞ = 0.5
            const cos = Math.abs(Math.cos(rotY));
            const sin = Math.abs(Math.sin(rotY));

            // –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–∞—Å—á—ë—Ç AABB –¥–ª—è –ø–æ–≤—ë—Ä–Ω—É—Ç–æ–≥–æ –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∞
            const extentX = halfWidth * cos + halfDepth * sin;
            const extentZ = halfWidth * sin + halfDepth * cos;

            buildings.push({
                minX: x - extentX,
                maxX: x + extentX,
                minZ: z - extentZ,
                maxZ: z + extentZ
            });
        }

        // ========== –ö–ê–ú–£–§–õ–Ø–ñ ==========
        // –¶–≤–µ—Ç–∞ –∫–∞–º—É—Ñ–ª—è–∂–∞ (–ª–µ—Å–Ω–æ–π)
        const camoColors = [0x4B5320, 0x3D4F2F, 0x2F4F2F, 0x556B2F, 0x6B4423, 0x8B7355];

        // –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞–º—É—Ñ–ª—è–∂–Ω—ã—Ö –ø—è—Ç–µ–Ω –Ω–∞ –º–µ—à–µ
        function createCamoPatches(width, height, depth, offsetY = 0) {
            const camoGroup = new THREE.Group();
            const patchCount = Math.floor((width * height) * 15);

            for (let i = 0; i < patchCount; i++) {
                const patchSize = 0.08 + Math.random() * 0.12;
                const patchGeo = new THREE.BoxGeometry(patchSize, patchSize, 0.02);
                const patchMat = new THREE.MeshStandardMaterial({
                    color: camoColors[Math.floor(Math.random() * camoColors.length)]
                });
                const patch = new THREE.Mesh(patchGeo, patchMat);

                // –°–ª—É—á–∞–π–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è –Ω–∞ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏
                const side = Math.floor(Math.random() * 4); // 4 —Å—Ç–æ—Ä–æ–Ω—ã
                switch(side) {
                    case 0: // –ü–µ—Ä–µ–¥–Ω—è—è
                        patch.position.set(
                            (Math.random() - 0.5) * width * 0.9,
                            (Math.random() - 0.5) * height * 0.9 + offsetY,
                            -depth / 2 - 0.01
                        );
                        break;
                    case 1: // –ó–∞–¥–Ω—è—è
                        patch.position.set(
                            (Math.random() - 0.5) * width * 0.9,
                            (Math.random() - 0.5) * height * 0.9 + offsetY,
                            depth / 2 + 0.01
                        );
                        patch.rotation.y = Math.PI;
                        break;
                    case 2: // –õ–µ–≤–∞—è
                        patch.position.set(
                            -width / 2 - 0.01,
                            (Math.random() - 0.5) * height * 0.9 + offsetY,
                            (Math.random() - 0.5) * depth * 0.9
                        );
                        patch.rotation.y = Math.PI / 2;
                        break;
                    case 3: // –ü—Ä–∞–≤–∞—è
                        patch.position.set(
                            width / 2 + 0.01,
                            (Math.random() - 0.5) * height * 0.9 + offsetY,
                            (Math.random() - 0.5) * depth * 0.9
                        );
                        patch.rotation.y = -Math.PI / 2;
                        break;
                }
                camoGroup.add(patch);
            }
            return camoGroup;
        }

        // ========== –ò–ì–†–û–ö (–°–¢–ò–õ–¨ ROBLOX) ==========
        function createPlayer() {
            player = new THREE.Group();

            // –¶–≤–µ—Ç–∞
            const skinColor = 0xFFDBB4;
            const shirtColor = 0x2E8B57;
            const pantsColor = 0x1E3A5F;

            // –ü–æ–∑–∏—Ü–∏–∏ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω—ã —Ç–∞–∫, —á—Ç–æ–±—ã –Ω–æ–≥–∏ –∫–∞—Å–∞–ª–∏—Å—å –∑–µ–º–ª–∏ (y=0)
            // –õ–µ–≤–∞—è –Ω–æ–≥–∞
            const legGeo = new THREE.BoxGeometry(0.5, 1, 0.5);
            const legMat = new THREE.MeshStandardMaterial({ color: pantsColor });
            playerBody.leftLeg = new THREE.Mesh(legGeo, legMat);
            playerBody.leftLeg.position.set(-0.3, 0.5, 0); // —Ü–µ–Ω—Ç—Ä –Ω–æ–≥–∏ –Ω–∞ 0.5
            playerBody.leftLeg.castShadow = true;
            player.add(playerBody.leftLeg);

            // –ü—Ä–∞–≤–∞—è –Ω–æ–≥–∞
            playerBody.rightLeg = new THREE.Mesh(legGeo, legMat);
            playerBody.rightLeg.position.set(0.3, 0.5, 0);
            playerBody.rightLeg.castShadow = true;
            player.add(playerBody.rightLeg);

            // –¢—É–ª–æ–≤–∏—â–µ (–Ω–∞–¥ –Ω–æ–≥–∞–º–∏)
            const torsoGeo = new THREE.BoxGeometry(1.2, 1.5, 0.6);
            const torsoMat = new THREE.MeshStandardMaterial({ color: shirtColor });
            playerBody.torso = new THREE.Mesh(torsoGeo, torsoMat);
            playerBody.torso.position.y = 1.75; // 1 (–≤–µ—Ä—Ö –Ω–æ–≥) + 0.75 (–ø–æ–ª–æ–≤–∏–Ω–∞ —Ç—É–ª–æ–≤–∏—â–∞)
            playerBody.torso.castShadow = true;
            player.add(playerBody.torso);

            // –ë—Ä–æ–Ω–µ–∂–∏–ª–µ—Ç (–∏–∑–Ω–∞—á–∞–ª—å–Ω–æ —Å–∫—Ä—ã—Ç)
            playerBody.vest = createVest();
            playerBody.vest.position.y = 1.75;
            playerBody.vest.visible = false;
            player.add(playerBody.vest);

            // –ì–æ–ª–æ–≤–∞
            const headGeo = new THREE.BoxGeometry(1, 1, 1);
            const headMat = new THREE.MeshStandardMaterial({ color: skinColor });
            playerBody.head = new THREE.Mesh(headGeo, headMat);
            playerBody.head.position.y = 3;
            playerBody.head.castShadow = true;
            player.add(playerBody.head);

            // –ë–∞–ª–∞–∫–ª–∞–≤–∞ (—Å–∫—Ä—ã—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) - –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –ª–∏—Ü–æ
            playerBody.balaclava = createBalaclava();
            playerBody.balaclava.position.y = 3;
            playerBody.balaclava.visible = false;
            player.add(playerBody.balaclava);

            // –®–ª–µ–º (—Å–∫—Ä—ã—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
            playerBody.helmet = createHelmet();
            playerBody.helmet.position.y = 3.3;
            playerBody.helmet.visible = false;
            player.add(playerBody.helmet);

            // –ù–∞–∫–æ–ª–µ–Ω–Ω–∏–∫–∏ (—Å–∫—Ä—ã—Ç—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
            playerBody.leftKneePad = createKneePad();
            playerBody.leftKneePad.position.set(-0.3, 0.65, -0.28);
            playerBody.leftKneePad.visible = false;
            player.add(playerBody.leftKneePad);

            playerBody.rightKneePad = createKneePad();
            playerBody.rightKneePad.position.set(0.3, 0.65, -0.28);
            playerBody.rightKneePad.visible = false;
            player.add(playerBody.rightKneePad);

            // –ö–∞–º—É—Ñ–ª—è–∂ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —á–∞—Å—Ç–µ–π —Ç–µ–ª–∞ (—Å–∫—Ä—ã—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
            playerBody.camouflage = new THREE.Group();

            // –ö–∞–º—É—Ñ–ª—è–∂ –Ω–∞ —Ç–æ—Ä—Å
            const torsoCamo = createCamoPatches(1.2, 1.5, 0.6);
            torsoCamo.position.y = 1.75;
            playerBody.camouflage.add(torsoCamo);

            // –ö–∞–º—É—Ñ–ª—è–∂ –Ω–∞ –ª–µ–≤—É—é –Ω–æ–≥—É
            const leftLegCamo = createCamoPatches(0.5, 1, 0.5);
            leftLegCamo.position.set(-0.3, 0.5, 0);
            playerBody.camouflage.add(leftLegCamo);

            // –ö–∞–º—É—Ñ–ª—è–∂ –Ω–∞ –ø—Ä–∞–≤—É—é –Ω–æ–≥—É
            const rightLegCamo = createCamoPatches(0.5, 1, 0.5);
            rightLegCamo.position.set(0.3, 0.5, 0);
            playerBody.camouflage.add(rightLegCamo);

            // –ö–∞–º—É—Ñ–ª—è–∂ –Ω–∞ –ª–µ–≤—É—é —Ä—É–∫—É
            const leftArmCamo = createCamoPatches(0.4, 1.2, 0.4);
            leftArmCamo.position.set(-0.8, 1.75, 0);
            playerBody.camouflage.add(leftArmCamo);

            playerBody.camouflage.visible = false;
            player.add(playerBody.camouflage);

            // –õ—ë–≥–∫–∏–π –±—Ä–æ–Ω–µ–∂–∏–ª–µ—Ç/—Ä–∞–∑–≥—Ä—É–∑–∫–∞ (–¥–ª—è —Å—Ä–µ–¥–Ω–µ–π –±—Ä–æ–Ω–∏)
            playerBody.tacticalVest = createTacticalVest();
            playerBody.tacticalVest.position.y = 1.75;
            playerBody.tacticalVest.visible = false;
            player.add(playerBody.tacticalVest);

            // –¢—è–∂—ë–ª—ã–π –±—Ä–æ–Ω–µ–∂–∏–ª–µ—Ç (–¥–ª—è —Ç—è–∂—ë–ª–æ–π –±—Ä–æ–Ω–∏)
            playerBody.heavyVest = createHeavyVest();
            playerBody.heavyVest.position.y = 1.75;
            playerBody.heavyVest.visible = false;
            player.add(playerBody.heavyVest);

            // –í–æ–µ–Ω–Ω—ã–π —à–ª–µ–º (–¥–ª—è —Ç—è–∂—ë–ª–æ–π –±—Ä–æ–Ω–∏)
            playerBody.militaryHelmet = createMilitaryHelmet();
            playerBody.militaryHelmet.position.y = 3.1;
            playerBody.militaryHelmet.visible = false;
            player.add(playerBody.militaryHelmet);

            // –õ–µ–≤–∞—è —Ä—É–∫–∞
            const armGeo = new THREE.BoxGeometry(0.4, 1.2, 0.4);
            const armMat = new THREE.MeshStandardMaterial({ color: skinColor });
            playerBody.leftArm = new THREE.Mesh(armGeo, armMat);
            playerBody.leftArm.position.set(-0.8, 1.75, 0);
            playerBody.leftArm.castShadow = true;
            player.add(playerBody.leftArm);

            // –ü—Ä–∞–≤–∞—è —Ä—É–∫–∞ (—Å –ø–∏—Å—Ç–æ–ª–µ—Ç–æ–º) - –≤—ã—Ç—è–Ω—É—Ç–∞ –í–ü–ï–†–Å–î –¥–ª—è –ø—Ä–∏—Ü–µ–ª–∏–≤–∞–Ω–∏—è
            const rightArmGroup = new THREE.Group();
            rightArmGroup.position.set(0.7, 1.9, 0); // –ü–æ–∑–∏—Ü–∏—è –ø–ª–µ—á–∞
            // –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–π —É–≥–æ–ª X –ø–æ–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç —Ä—É–∫—É –í–ü–ï–†–Å–î (–∫ -Z)
            rightArmGroup.rotation.x = Math.PI / 2.5; // –†—É–∫–∞ –≤–ø–µ—Ä—ë–¥

            playerBody.rightArm = new THREE.Mesh(armGeo, armMat);
            playerBody.rightArm.position.set(0, -0.6, 0); // –†—É–∫–∞ –æ—Ç –ø–ª–µ—á–∞
            playerBody.rightArm.castShadow = true;
            rightArmGroup.add(playerBody.rightArm);

            // –ü–∏—Å—Ç–æ–ª–µ—Ç –≤ –≤—ã—Ç—è–Ω—É—Ç–æ–π —Ä—É–∫–µ - –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω –í–ü–ï–†–Å–î
            playerBody.gun = createPistol();
            playerBody.gun.position.set(0, -1.1, 0); // –í –∫–æ–Ω—Ü–µ —Ä—É–∫–∏
            playerBody.gun.rotation.x = -Math.PI / 2.5; // –ö–æ–º–ø–µ–Ω—Å–∏—Ä—É–µ–º –ø–æ–≤–æ—Ä–æ—Ç —Ä—É–∫–∏, –ø–∏—Å—Ç–æ–ª–µ—Ç —Å–º–æ—Ç—Ä–∏—Ç –≤–ø–µ—Ä—ë–¥
            playerBody.gun.rotation.y = Math.PI; // –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –ø–∏—Å—Ç–æ–ª–µ—Ç —Å—Ç–≤–æ–ª–æ–º –≤–ø–µ—Ä—ë–¥
            rightArmGroup.add(playerBody.gun);

            player.add(rightArmGroup);
            playerBody.rightArmGroup = rightArmGroup;

            // –ü–∏—Å—Ç–æ–ª–µ—Ç –¥–ª—è –≤–∏–¥–∞ –æ—Ç –ø–µ—Ä–≤–æ–≥–æ –ª–∏—Ü–∞ (–æ—Ç–¥–µ–ª—å–Ω—ã–π, –≤–∏–¥–µ–Ω —Ç–æ–ª—å–∫–æ –≤ FPS)
            playerBody.fpsGun = createPistol();
            playerBody.fpsGun.scale.set(2, 2, 2); // –ö—Ä—É–ø–Ω–µ–µ –¥–ª—è FPS
            playerBody.fpsGun.visible = false;
            scene.add(playerBody.fpsGun);

            // –î—Ä–æ–±–æ–≤–∏–∫ (—Å–∫—Ä—ã—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –ø–æ–∫–∞ –Ω–µ –∫—É–ø–ª–µ–Ω)
            playerBody.shotgun = createShotgun();
            playerBody.shotgun.position.set(0, -1.1, 0);
            playerBody.shotgun.rotation.x = -Math.PI / 2.5;
            playerBody.shotgun.rotation.y = Math.PI;
            playerBody.shotgun.scale.set(0.8, 0.8, 0.8);
            playerBody.shotgun.visible = false;
            playerBody.rightArmGroup.add(playerBody.shotgun);

            // –î—Ä–æ–±–æ–≤–∏–∫ –¥–ª—è FPS
            playerBody.fpsShotgun = createShotgun();
            playerBody.fpsShotgun.scale.set(1.5, 1.5, 1.5);
            playerBody.fpsShotgun.visible = false;
            scene.add(playerBody.fpsShotgun);

            player.position.set(0, 0, 0); // –ò–≥—Ä–æ–∫ —Å—Ç–æ–∏—Ç –Ω–∞ –∑–µ–º–ª–µ
            scene.add(player);
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –æ—Ä—É–∂–∏—è
        function switchWeapon(weapon) {
            if (weapon === 'shotgun' && !gameState.hasShotgun) {
                showMessage('–£ –≤–∞—Å –Ω–µ—Ç –¥—Ä–æ–±–æ–≤–∏–∫–∞! –ö—É–ø–∏—Ç–µ –≤ –º–∞–≥–∞–∑–∏–Ω–µ.');
                return;
            }

            gameState.currentWeapon = weapon;

            // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å –æ—Ä—É–∂–∏—è
            if (weapon === 'pistol') {
                playerBody.gun.visible = true;
                playerBody.shotgun.visible = false;
                showMessage('–ü–∏—Å—Ç–æ–ª–µ—Ç (1)');
                // –û–±–Ω–æ–≤–ª—è–µ–º UI –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
                document.getElementById('slot1').classList.add('active');
                document.getElementById('slot2').classList.remove('active');
            } else if (weapon === 'shotgun') {
                playerBody.gun.visible = false;
                playerBody.shotgun.visible = true;
                showMessage('–î—Ä–æ–±–æ–≤–∏–∫ (2)');
                // –û–±–Ω–æ–≤–ª—è–µ–º UI –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
                document.getElementById('slot1').classList.remove('active');
                document.getElementById('slot2').classList.add('active');
            }

            updateHUD();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ –¥—Ä–æ–±–æ–≤–∏–∫–∞
        function updateShotgunUI() {
            if (gameState.hasShotgun) {
                document.getElementById('shotgunIcon').style.opacity = '1';
                document.getElementById('shotgunName').style.opacity = '1';
            } else {
                document.getElementById('shotgunIcon').style.opacity = '0.3';
                document.getElementById('shotgunName').style.opacity = '0.3';
            }
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –±—Ä–æ–Ω–µ–∂–∏–ª–µ—Ç–∞ —Å –Ω–∞–¥–ø–∏—Å—å—é SWAT
        function createVest() {
            const vestGroup = new THREE.Group();

            // –û—Å–Ω–æ–≤–∞ –∂–∏–ª–µ—Ç–∞ (—á—É—Ç—å –±–æ–ª—å—à–µ —Ç—É–ª–æ–≤–∏—â–∞)
            const vestGeo = new THREE.BoxGeometry(1.3, 1.4, 0.7);
            const vestMat = new THREE.MeshStandardMaterial({ color: 0x2a2a2a });
            const vest = new THREE.Mesh(vestGeo, vestMat);
            vest.castShadow = true;
            vestGroup.add(vest);

            // –ü–µ—Ä–µ–¥–Ω–∏–µ –∫–∞—Ä–º–∞–Ω—ã
            const pocketGeo = new THREE.BoxGeometry(0.3, 0.3, 0.1);
            const pocketMat = new THREE.MeshStandardMaterial({ color: 0x1a1a1a });

            const pocket1 = new THREE.Mesh(pocketGeo, pocketMat);
            pocket1.position.set(-0.35, 0.2, -0.35);
            vestGroup.add(pocket1);

            const pocket2 = new THREE.Mesh(pocketGeo, pocketMat);
            pocket2.position.set(0.35, 0.2, -0.35);
            vestGroup.add(pocket2);

            const pocket3 = new THREE.Mesh(pocketGeo, pocketMat);
            pocket3.position.set(-0.35, -0.2, -0.35);
            vestGroup.add(pocket3);

            const pocket4 = new THREE.Mesh(pocketGeo, pocketMat);
            pocket4.position.set(0.35, -0.2, -0.35);
            vestGroup.add(pocket4);

            // –ù–∞–¥–ø–∏—Å—å SWAT –Ω–∞ —Å–ø–∏–Ω–µ (–∏–∑ –º–∞–ª–µ–Ω—å–∫–∏—Ö –∫—É–±–∏–∫–æ–≤)
            const letterMat = new THREE.MeshStandardMaterial({ color: 0xFFFFFF });
            const letterSize = 0.08;

            // –ë—É–∫–≤–∞ S
            createLetter_S(vestGroup, -0.4, 0.1, 0.36, letterSize, letterMat);
            // –ë—É–∫–≤–∞ W
            createLetter_W(vestGroup, -0.15, 0.1, 0.36, letterSize, letterMat);
            // –ë—É–∫–≤–∞ A
            createLetter_A(vestGroup, 0.15, 0.1, 0.36, letterSize, letterMat);
            // –ë—É–∫–≤–∞ T
            createLetter_T(vestGroup, 0.4, 0.1, 0.36, letterSize, letterMat);

            return vestGroup;
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–ª–∞–∫–ª–∞–≤—ã (–º–∞—Å–∫–∞ –Ω–∞ –ª–∏—Ü–æ)
        function createBalaclava() {
            const balaclavaGroup = new THREE.Group();
            const balaclavaMat = new THREE.MeshStandardMaterial({ color: 0x1a1a1a });

            // –û—Å–Ω–æ–≤–∞ –±–∞–ª–∞–∫–ª–∞–≤—ã (–ø–æ–∫—Ä—ã–≤–∞–µ—Ç –≥–æ–ª–æ–≤—É)
            const baseGeo = new THREE.BoxGeometry(1.05, 1.05, 1.05);
            const base = new THREE.Mesh(baseGeo, balaclavaMat);
            base.castShadow = true;
            balaclavaGroup.add(base);

            // –í—ã—Ä–µ–∑ –¥–ª—è –≥–ª–∞–∑ (—Å–≤–µ—Ç–ª–∞—è –ø–æ–ª–æ—Å–∞)
            const eyeSlotGeo = new THREE.BoxGeometry(0.8, 0.2, 0.1);
            const eyeSlotMat = new THREE.MeshStandardMaterial({ color: 0x333333 });
            const eyeSlot = new THREE.Mesh(eyeSlotGeo, eyeSlotMat);
            eyeSlot.position.set(0, 0.15, -0.53);
            balaclavaGroup.add(eyeSlot);

            return balaclavaGroup;
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ —à–ª–µ–º–∞
        function createHelmet() {
            const helmetGroup = new THREE.Group();
            const helmetMat = new THREE.MeshStandardMaterial({ color: 0x2a2a2a });

            // –û—Å–Ω–æ–≤–∞ —à–ª–µ–º–∞ (–ø–æ–ª—É—Å—Ñ–µ—Ä–∞ –∏–∑ –∫—É–±–æ–≤)
            const helmetBase = new THREE.BoxGeometry(1.15, 0.5, 1.15);
            const base = new THREE.Mesh(helmetBase, helmetMat);
            base.castShadow = true;
            helmetGroup.add(base);

            // –í–µ—Ä—Ö–Ω—è—è —á–∞—Å—Ç—å —à–ª–µ–º–∞
            const topGeo = new THREE.BoxGeometry(1.0, 0.3, 1.0);
            const top = new THREE.Mesh(topGeo, helmetMat);
            top.position.y = 0.35;
            top.castShadow = true;
            helmetGroup.add(top);

            // –ö–æ–∑—ã—Ä—ë–∫
            const visorGeo = new THREE.BoxGeometry(1.1, 0.1, 0.3);
            const visorMat = new THREE.MeshStandardMaterial({ color: 0x1a1a1a });
            const visor = new THREE.Mesh(visorGeo, visorMat);
            visor.position.set(0, -0.1, -0.55);
            visor.rotation.x = -0.2;
            visor.castShadow = true;
            helmetGroup.add(visor);

            // –ö—Ä–µ–ø–ª–µ–Ω–∏—è –ø–æ –±–æ–∫–∞–º
            const sideMat = new THREE.MeshStandardMaterial({ color: 0x3a3a3a });
            const sideGeo = new THREE.BoxGeometry(0.15, 0.3, 0.4);

            const leftSide = new THREE.Mesh(sideGeo, sideMat);
            leftSide.position.set(-0.6, -0.1, 0);
            helmetGroup.add(leftSide);

            const rightSide = new THREE.Mesh(sideGeo, sideMat);
            rightSide.position.set(0.6, -0.1, 0);
            helmetGroup.add(rightSide);

            return helmetGroup;
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–∞–∫–æ–ª–µ–Ω–Ω–∏–∫–∞
        function createKneePad() {
            const kneePadGroup = new THREE.Group();
            const kneePadMat = new THREE.MeshStandardMaterial({ color: 0x2a2a2a });

            // –û—Å–Ω–æ–≤–∞ –Ω–∞–∫–æ–ª–µ–Ω–Ω–∏–∫–∞
            const padGeo = new THREE.BoxGeometry(0.35, 0.4, 0.15);
            const pad = new THREE.Mesh(padGeo, kneePadMat);
            pad.castShadow = true;
            kneePadGroup.add(pad);

            // –£—Å–∏–ª–µ–Ω–∏–µ (–≤—ã–ø—É–∫–ª–æ—Å—Ç—å)
            const reinforceGeo = new THREE.BoxGeometry(0.25, 0.25, 0.08);
            const reinforceMat = new THREE.MeshStandardMaterial({ color: 0x3a3a3a });
            const reinforce = new THREE.Mesh(reinforceGeo, reinforceMat);
            reinforce.position.z = -0.1;
            kneePadGroup.add(reinforce);

            return kneePadGroup;
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ –∂–∏–ª–µ—Ç–∞/—Ä–∞–∑–≥—Ä—É–∑–∫–∏ (–¥–ª—è —Å—Ä–µ–¥–Ω–µ–π –±—Ä–æ–Ω–∏)
        function createTacticalVest() {
            const vestGroup = new THREE.Group();
            const vestMat = new THREE.MeshStandardMaterial({ color: 0x2F4F2F }); // –¢—ë–º–Ω–æ-–∑–µ–ª—ë–Ω—ã–π

            // –û—Å–Ω–æ–≤–∞ —Ä–∞–∑–≥—Ä—É–∑–∫–∏ (–ø–ª–æ—Å–∫–∏–π –±–ª–æ–∫ –ø–æ–≤–µ—Ä—Ö —Ç–æ—Ä—Å–∞)
            const vestGeo = new THREE.BoxGeometry(1.25, 1.3, 0.65);
            const vest = new THREE.Mesh(vestGeo, vestMat);
            vest.castShadow = true;
            vestGroup.add(vest);

            // –ü–æ–¥—Å—É–º–∫–∏ —Å–ø–µ—Ä–µ–¥–∏ (–¥–ª—è –º–∞–≥–∞–∑–∏–Ω–æ–≤)
            const pouchMat = new THREE.MeshStandardMaterial({ color: 0x3D4F2F });
            const pouchGeo = new THREE.BoxGeometry(0.25, 0.35, 0.12);

            for (let i = 0; i < 3; i++) {
                const pouch = new THREE.Mesh(pouchGeo, pouchMat);
                pouch.position.set(-0.3 + i * 0.3, -0.25, -0.38);
                pouch.castShadow = true;
                vestGroup.add(pouch);
            }

            // –õ—è–º–∫–∏ –Ω–∞ –ø–ª–µ—á–∞—Ö
            const strapMat = new THREE.MeshStandardMaterial({ color: 0x4B5320 });
            const strapGeo = new THREE.BoxGeometry(0.15, 0.4, 0.6);

            const leftStrap = new THREE.Mesh(strapGeo, strapMat);
            leftStrap.position.set(-0.45, 0.55, 0);
            vestGroup.add(leftStrap);

            const rightStrap = new THREE.Mesh(strapGeo, strapMat);
            rightStrap.position.set(0.45, 0.55, 0);
            vestGroup.add(rightStrap);

            return vestGroup;
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ —Ç—è–∂—ë–ª–æ–≥–æ –±—Ä–æ–Ω–µ–∂–∏–ª–µ—Ç–∞ (–¥–ª—è —Ç—è–∂—ë–ª–æ–π –±—Ä–æ–Ω–∏)
        function createHeavyVest() {
            const vestGroup = new THREE.Group();
            const vestMat = new THREE.MeshStandardMaterial({ color: 0x2F4F2F });

            // –û—Å–Ω–æ–≤–∞ —Ç—è–∂—ë–ª–æ–≥–æ –±—Ä–æ–Ω–µ–∂–∏–ª–µ—Ç–∞ (–±–æ–ª—å—à–µ –∏ —Ç–æ–ª—â–µ)
            const vestGeo = new THREE.BoxGeometry(1.35, 1.45, 0.75);
            const vest = new THREE.Mesh(vestGeo, vestMat);
            vest.castShadow = true;
            vestGroup.add(vest);

            // –ë—Ä–æ–Ω–µ–ø–ª–∞—Å—Ç–∏–Ω—ã —Å–ø–µ—Ä–µ–¥–∏
            const plateMat = new THREE.MeshStandardMaterial({ color: 0x1a3a1a });
            const frontPlateGeo = new THREE.BoxGeometry(0.8, 0.9, 0.1);
            const frontPlate = new THREE.Mesh(frontPlateGeo, plateMat);
            frontPlate.position.set(0, 0.1, -0.42);
            frontPlate.castShadow = true;
            vestGroup.add(frontPlate);

            // –ë—Ä–æ–Ω–µ–ø–ª–∞—Å—Ç–∏–Ω–∞ —Å–∑–∞–¥–∏
            const backPlate = new THREE.Mesh(frontPlateGeo, plateMat);
            backPlate.position.set(0, 0.1, 0.42);
            backPlate.castShadow = true;
            vestGroup.add(backPlate);

            // –ü–æ–¥—Å—É–º–∫–∏ (–±–æ–ª—å—à–µ —á–µ–º —É —Ä–∞–∑–≥—Ä—É–∑–∫–∏)
            const pouchMat = new THREE.MeshStandardMaterial({ color: 0x3D4F2F });
            const pouchGeo = new THREE.BoxGeometry(0.28, 0.4, 0.15);

            for (let i = 0; i < 3; i++) {
                const pouch = new THREE.Mesh(pouchGeo, pouchMat);
                pouch.position.set(-0.35 + i * 0.35, -0.35, -0.44);
                pouch.castShadow = true;
                vestGroup.add(pouch);
            }

            // –ë–æ–∫–æ–≤—ã–µ –∑–∞—â–∏—Ç–Ω—ã–µ –ø–∞–Ω–µ–ª–∏
            const sideMat = new THREE.MeshStandardMaterial({ color: 0x2a4a2a });
            const sideGeo = new THREE.BoxGeometry(0.12, 1.0, 0.5);

            const leftSide = new THREE.Mesh(sideGeo, sideMat);
            leftSide.position.set(-0.72, 0, 0);
            vestGroup.add(leftSide);

            const rightSide = new THREE.Mesh(sideGeo, sideMat);
            rightSide.position.set(0.72, 0, 0);
            vestGroup.add(rightSide);

            // –í–æ—Ä–æ—Ç–Ω–∏–∫ (–∑–∞—â–∏—Ç–∞ —à–µ–∏)
            const collarMat = new THREE.MeshStandardMaterial({ color: 0x3a5a3a });
            const collarGeo = new THREE.BoxGeometry(1.0, 0.25, 0.6);
            const collar = new THREE.Mesh(collarGeo, collarMat);
            collar.position.set(0, 0.75, 0.05);
            vestGroup.add(collar);

            return vestGroup;
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –≤–æ–µ–Ω–Ω–æ–≥–æ —à–ª–µ–º–∞ (–¥–ª—è —Ç—è–∂—ë–ª–æ–π –±—Ä–æ–Ω–∏)
        function createMilitaryHelmet() {
            const helmetGroup = new THREE.Group();
            const helmetMat = new THREE.MeshStandardMaterial({ color: 0x2F4F2F }); // –¢—ë–º–Ω–æ-–∑–µ–ª—ë–Ω—ã–π

            // –û—Å–Ω–æ–≤–∞ —à–ª–µ–º–∞ (–∫–∞—Å–∫–∞)
            const baseGeo = new THREE.BoxGeometry(1.1, 0.6, 1.1);
            const base = new THREE.Mesh(baseGeo, helmetMat);
            base.castShadow = true;
            helmetGroup.add(base);

            // –í–µ—Ä—Ö–Ω—è—è —á–∞—Å—Ç—å (—Å–∫—Ä—É–≥–ª—ë–Ω–Ω–∞—è –∏–∑ –∫—É–±–æ–≤)
            const topGeo = new THREE.BoxGeometry(0.95, 0.3, 0.95);
            const top = new THREE.Mesh(topGeo, helmetMat);
            top.position.y = 0.4;
            top.castShadow = true;
            helmetGroup.add(top);

            // –ö–æ–∑—ã—Ä—ë–∫
            const visorMat = new THREE.MeshStandardMaterial({ color: 0x1a3a1a });
            const visorGeo = new THREE.BoxGeometry(1.0, 0.1, 0.25);
            const visor = new THREE.Mesh(visorGeo, visorMat);
            visor.position.set(0, -0.15, -0.6);
            visor.rotation.x = -0.15;
            visor.castShadow = true;
            helmetGroup.add(visor);

            // –ö—Ä–µ–ø–ª–µ–Ω–∏–µ –¥–ª—è –æ—á–∫–æ–≤/–ø—Ä–∏–±–æ—Ä–∞ –Ω–æ—á–Ω–æ–≥–æ –≤–∏–¥–µ–Ω–∏—è
            const mountMat = new THREE.MeshStandardMaterial({ color: 0x1a1a1a });
            const mountGeo = new THREE.BoxGeometry(0.3, 0.15, 0.15);
            const mount = new THREE.Mesh(mountGeo, mountMat);
            mount.position.set(0, 0.1, -0.6);
            helmetGroup.add(mount);

            // –ë–æ–∫–æ–≤—ã–µ —Ä–µ–ª—å—Å—ã (–¥–ª—è –∞–∫—Å–µ—Å—Å—É–∞—Ä–æ–≤)
            const railMat = new THREE.MeshStandardMaterial({ color: 0x3a3a3a });
            const railGeo = new THREE.BoxGeometry(0.08, 0.12, 0.6);

            const leftRail = new THREE.Mesh(railGeo, railMat);
            leftRail.position.set(-0.58, 0, 0);
            helmetGroup.add(leftRail);

            const rightRail = new THREE.Mesh(railGeo, railMat);
            rightRail.position.set(0.58, 0, 0);
            helmetGroup.add(rightRail);

            // –ö–∞–º—É—Ñ–ª—è–∂–Ω—ã–µ –ø—è—Ç–Ω–∞ –Ω–∞ —à–ª–µ–º–µ
            const camoPatchCount = 8;
            for (let i = 0; i < camoPatchCount; i++) {
                const patchSize = 0.1 + Math.random() * 0.15;
                const patchGeo = new THREE.BoxGeometry(patchSize, patchSize, 0.02);
                const patchMat = new THREE.MeshStandardMaterial({
                    color: camoColors[Math.floor(Math.random() * camoColors.length)]
                });
                const patch = new THREE.Mesh(patchGeo, patchMat);

                const angle = Math.random() * Math.PI * 2;
                const radius = 0.4 + Math.random() * 0.15;
                patch.position.set(
                    Math.cos(angle) * radius * 0.8,
                    0.2 + Math.random() * 0.3,
                    Math.sin(angle) * radius * 0.8
                );
                patch.lookAt(0, patch.position.y, 0);
                helmetGroup.add(patch);
            }

            return helmetGroup;
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –ø–∏—Å—Ç–æ–ª–µ—Ç–∞ (–∫—Ä—É–ø–Ω—ã–π –∏ –≤–∏–¥–∏–º—ã–π)
        function createPistol() {
            const gunGroup = new THREE.Group();

            // –ú–∞—Ç–µ—Ä–∏–∞–ª—ã
            const gunMat = new THREE.MeshStandardMaterial({ color: 0x222222 });
            const metalMat = new THREE.MeshStandardMaterial({ color: 0x444444 });

            // –°—Ç–≤–æ–ª (–æ—Å–Ω–æ–≤–Ω–∞—è —á–∞—Å—Ç—å)
            const barrelGeo = new THREE.BoxGeometry(0.12, 0.15, 0.5);
            const barrel = new THREE.Mesh(barrelGeo, gunMat);
            barrel.position.z = 0.1;
            barrel.castShadow = true;
            gunGroup.add(barrel);

            // –ó–∞—Ç–≤–æ—Ä (–≤–µ—Ä—Ö–Ω—è—è —á–∞—Å—Ç—å)
            const slideGeo = new THREE.BoxGeometry(0.14, 0.1, 0.45);
            const slide = new THREE.Mesh(slideGeo, metalMat);
            slide.position.set(0, 0.1, 0.08);
            slide.castShadow = true;
            gunGroup.add(slide);

            // –†—É–∫–æ—è—Ç–∫–∞
            const gripGeo = new THREE.BoxGeometry(0.1, 0.35, 0.18);
            const grip = new THREE.Mesh(gripGeo, gunMat);
            grip.position.set(0, -0.15, -0.12);
            grip.rotation.x = 0.2;
            grip.castShadow = true;
            gunGroup.add(grip);

            // –°–ø—É—Å–∫–æ–≤–∞—è —Å–∫–æ–±–∞
            const triggerGuardGeo = new THREE.BoxGeometry(0.08, 0.12, 0.1);
            const triggerGuard = new THREE.Mesh(triggerGuardGeo, metalMat);
            triggerGuard.position.set(0, -0.08, 0.02);
            gunGroup.add(triggerGuard);

            // –ú—É—à–∫–∞ (–ø—Ä–∏—Ü–µ–ª —Å–ø–µ—Ä–µ–¥–∏)
            const frontSightGeo = new THREE.BoxGeometry(0.04, 0.06, 0.04);
            const frontSight = new THREE.Mesh(frontSightGeo, metalMat);
            frontSight.position.set(0, 0.18, 0.3);
            gunGroup.add(frontSight);

            // –¶–µ–ª–∏–∫ (–ø—Ä–∏—Ü–µ–ª —Å–∑–∞–¥–∏)
            const rearSightGeo = new THREE.BoxGeometry(0.1, 0.05, 0.04);
            const rearSight = new THREE.Mesh(rearSightGeo, metalMat);
            rearSight.position.set(0, 0.17, -0.12);
            gunGroup.add(rearSight);

            return gunGroup;
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –¥—Ä–æ–±–æ–≤–∏–∫–∞
        function createShotgun() {
            const gunGroup = new THREE.Group();

            // –ú–∞—Ç–µ—Ä–∏–∞–ª—ã
            const metalMat = new THREE.MeshStandardMaterial({ color: 0x333333 });
            const woodMat = new THREE.MeshStandardMaterial({ color: 0x5c4033 });
            const darkMetalMat = new THREE.MeshStandardMaterial({ color: 0x1a1a1a });

            // –î–ª–∏–Ω–Ω—ã–π —Å—Ç–≤–æ–ª
            const barrelGeo = new THREE.BoxGeometry(0.12, 0.12, 1.0);
            const barrel = new THREE.Mesh(barrelGeo, metalMat);
            barrel.position.z = 0.3;
            barrel.castShadow = true;
            gunGroup.add(barrel);

            // –ü–æ–¥—Å—Ç–≤–æ–ª—å–Ω—ã–π –º–∞–≥–∞–∑–∏–Ω
            const magTubeGeo = new THREE.BoxGeometry(0.1, 0.1, 0.7);
            const magTube = new THREE.Mesh(magTubeGeo, metalMat);
            magTube.position.set(0, -0.1, 0.15);
            magTube.castShadow = true;
            gunGroup.add(magTube);

            // –°—Ç–≤–æ–ª—å–Ω–∞—è –∫–æ—Ä–æ–±–∫–∞
            const receiverGeo = new THREE.BoxGeometry(0.15, 0.18, 0.35);
            const receiver = new THREE.Mesh(receiverGeo, darkMetalMat);
            receiver.position.set(0, 0, -0.15);
            receiver.castShadow = true;
            gunGroup.add(receiver);

            // –î–µ—Ä–µ–≤—è–Ω–Ω—ã–π –ø—Ä–∏–∫–ª–∞–¥
            const stockGeo = new THREE.BoxGeometry(0.12, 0.15, 0.45);
            const stock = new THREE.Mesh(stockGeo, woodMat);
            stock.position.set(0, -0.02, -0.5);
            stock.castShadow = true;
            gunGroup.add(stock);

            // –ó–∞—Ç—ã–ª—å–Ω–∏–∫ –ø—Ä–∏–∫–ª–∞–¥–∞
            const buttpadGeo = new THREE.BoxGeometry(0.14, 0.18, 0.05);
            const buttpad = new THREE.Mesh(buttpadGeo, darkMetalMat);
            buttpad.position.set(0, -0.02, -0.74);
            gunGroup.add(buttpad);

            // –¶–µ–≤—å—ë (–ø–æ–º–ø–æ–≤—ã–π –º–µ—Ö–∞–Ω–∏–∑–º)
            const foreendGeo = new THREE.BoxGeometry(0.14, 0.14, 0.25);
            const foreend = new THREE.Mesh(foreendGeo, woodMat);
            foreend.position.set(0, -0.05, 0.25);
            foreend.castShadow = true;
            gunGroup.add(foreend);

            // –†—É–∫–æ—è—Ç–∫–∞
            const gripGeo = new THREE.BoxGeometry(0.1, 0.25, 0.12);
            const grip = new THREE.Mesh(gripGeo, woodMat);
            grip.position.set(0, -0.18, -0.22);
            grip.rotation.x = 0.3;
            grip.castShadow = true;
            gunGroup.add(grip);

            // –°–ø—É—Å–∫–æ–≤–∞—è —Å–∫–æ–±–∞
            const triggerGuardGeo = new THREE.BoxGeometry(0.08, 0.08, 0.12);
            const triggerGuard = new THREE.Mesh(triggerGuardGeo, metalMat);
            triggerGuard.position.set(0, -0.12, -0.12);
            gunGroup.add(triggerGuard);

            // –ú—É—à–∫–∞
            const frontSightGeo = new THREE.BoxGeometry(0.04, 0.08, 0.04);
            const frontSight = new THREE.Mesh(frontSightGeo, metalMat);
            frontSight.position.set(0, 0.12, 0.75);
            gunGroup.add(frontSight);

            return gunGroup;
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –±—É–∫–≤ –∏–∑ –∫—É–±–∏–∫–æ–≤
        function createLetter_S(group, x, y, z, size, mat) {
            const positions = [
                [0, 2], [1, 2], [2, 2],
                [0, 1],
                [0, 0], [1, 0], [2, 0],
                        [2, -1],
                [0, -2], [1, -2], [2, -2]
            ];
            positions.forEach(p => {
                const cube = new THREE.Mesh(new THREE.BoxGeometry(size, size, size * 0.5), mat);
                cube.position.set(x + p[0] * size, y + p[1] * size, z);
                group.add(cube);
            });
        }

        function createLetter_W(group, x, y, z, size, mat) {
            const positions = [
                [0, 2], [0, 1], [0, 0], [0, -1], [0, -2],
                [1, -1],
                [2, 0], [2, -1],
                [3, -1],
                [4, 2], [4, 1], [4, 0], [4, -1], [4, -2]
            ];
            positions.forEach(p => {
                const cube = new THREE.Mesh(new THREE.BoxGeometry(size, size, size * 0.5), mat);
                cube.position.set(x + p[0] * size * 0.6, y + p[1] * size, z);
                group.add(cube);
            });
        }

        function createLetter_A(group, x, y, z, size, mat) {
            const positions = [
                [1, 2],
                [0, 1], [2, 1],
                [0, 0], [1, 0], [2, 0],
                [0, -1], [2, -1],
                [0, -2], [2, -2]
            ];
            positions.forEach(p => {
                const cube = new THREE.Mesh(new THREE.BoxGeometry(size, size, size * 0.5), mat);
                cube.position.set(x + p[0] * size, y + p[1] * size, z);
                group.add(cube);
            });
        }

        function createLetter_T(group, x, y, z, size, mat) {
            const positions = [
                [0, 2], [1, 2], [2, 2],
                [1, 1], [1, 0], [1, -1], [1, -2]
            ];
            positions.forEach(p => {
                const cube = new THREE.Mesh(new THREE.BoxGeometry(size, size, size * 0.5), mat);
                cube.position.set(x + p[0] * size, y + p[1] * size, z);
                group.add(cube);
            });
        }

        // ========== –ó–û–ú–ë–ò ==========
        function createZombie() {
            const zombie = new THREE.Group();
            zombie.userData = { health: 100 };

            const zombieColor = 0x355E3B;
            const clothesColor = 0x4A4A4A;

            // –ü–æ–∑–∏—Ü–∏–∏ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω—ã —Ç–∞–∫, —á—Ç–æ–±—ã –Ω–æ–≥–∏ –∫–∞—Å–∞–ª–∏—Å—å –∑–µ–º–ª–∏ (y=0)
            // –ù–æ–≥–∏
            const legGeo = new THREE.BoxGeometry(0.45, 0.9, 0.45);
            const legMat = new THREE.MeshStandardMaterial({ color: 0x2F2F2F });

            const leftLeg = new THREE.Mesh(legGeo, legMat);
            leftLeg.position.set(-0.28, 0.45, 0);
            leftLeg.castShadow = true;
            zombie.add(leftLeg);

            const rightLeg = new THREE.Mesh(legGeo, legMat);
            rightLeg.position.set(0.28, 0.45, 0);
            rightLeg.castShadow = true;
            zombie.add(rightLeg);

            // –¢—É–ª–æ–≤–∏—â–µ
            const torsoGeo = new THREE.BoxGeometry(1.1, 1.4, 0.5);
            const torsoMat = new THREE.MeshStandardMaterial({ color: clothesColor });
            const torso = new THREE.Mesh(torsoGeo, torsoMat);
            torso.position.y = 1.6;
            torso.castShadow = true;
            zombie.add(torso);

            // –ì–æ–ª–æ–≤–∞
            const headGeo = new THREE.BoxGeometry(0.9, 0.9, 0.9);
            const headMat = new THREE.MeshStandardMaterial({ color: zombieColor });
            const head = new THREE.Mesh(headGeo, headMat);
            head.position.y = 2.75;
            head.castShadow = true;
            zombie.add(head);

            // –†—É–∫–∏ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –∫—Ä–µ–ø–ª–µ–Ω–∏–µ–º –∫ –ø–ª–µ—á–∞–º (–∏—Å–ø–æ–ª—å–∑—É–µ–º –≥—Ä—É–ø–ø—ã –¥–ª—è –ø–æ–≤–æ—Ä–æ—Ç–∞)
            const armGeo = new THREE.BoxGeometry(0.35, 1.0, 0.35);
            const armMat = new THREE.MeshStandardMaterial({ color: zombieColor });

            // –õ–µ–≤–∞—è —Ä—É–∫–∞ - –≥—Ä—É–ø–ø–∞ –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –ø–æ–≤–æ—Ä–æ—Ç–∞ –æ—Ç –ø–ª–µ—á–∞
            const leftArmGroup = new THREE.Group();
            leftArmGroup.position.set(-0.72, 2.1, 0); // –ü–æ–∑–∏—Ü–∏—è –ø–ª–µ—á–∞
            const leftArm = new THREE.Mesh(armGeo, armMat);
            leftArm.position.set(0, -0.5, 0); // –°–º–µ—â–µ–Ω–∏–µ –≤–Ω–∏–∑ –æ—Ç —Ç–æ—á–∫–∏ –ø–æ–≤–æ—Ä–æ—Ç–∞
            leftArm.castShadow = true;
            leftArmGroup.add(leftArm);
            leftArmGroup.rotation.x = -1.3; // –†—É–∫–∏ –≤—ã—Ç—è–Ω—É—Ç—ã –≤–ø–µ—Ä—ë–¥
            zombie.add(leftArmGroup);

            // –ü—Ä–∞–≤–∞—è —Ä—É–∫–∞
            const rightArmGroup = new THREE.Group();
            rightArmGroup.position.set(0.72, 2.1, 0);
            const rightArm = new THREE.Mesh(armGeo, armMat);
            rightArm.position.set(0, -0.5, 0);
            rightArm.castShadow = true;
            rightArmGroup.add(rightArm);
            rightArmGroup.rotation.x = -1.3;
            zombie.add(rightArmGroup);

            return zombie;
        }

        function spawnZombie() {
            if (!gameState.isPlaying) return;

            const zombie = createZombie();

            // –°–ø–∞–≤–Ω –≤ —Å–ª—É—á–∞–π–Ω–æ–º –º–µ—Å—Ç–µ –Ω–∞ –∫—Ä–∞—é –∫–∞—Ä—Ç—ã
            const angle = Math.random() * Math.PI * 2;
            const distance = 60 + Math.random() * 20;
            zombie.position.x = Math.cos(angle) * distance;
            zombie.position.z = Math.sin(angle) * distance;
            zombie.position.y = 0; // –ó–æ–º–±–∏ —Å—Ç–æ–∏—Ç –Ω–∞ –∑–µ–º–ª–µ

            scene.add(zombie);
            zombies.push(zombie);
        }

        function updateZombies(delta) {
            const playerPos = player.position.clone();

            zombies.forEach((zombie, index) => {
                if (!zombie.userData.health || zombie.userData.health <= 0) return;

                // –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫ –∏–≥—Ä–æ–∫—É
                const direction = new THREE.Vector3();
                direction.subVectors(playerPos, zombie.position);
                direction.y = 0;
                direction.normalize();

                // –î–≤–∏–∂–µ–Ω–∏–µ –∫ –∏–≥—Ä–æ–∫—É
                const newX = zombie.position.x + direction.x * ZOMBIE_SPEED * delta;
                const newZ = zombie.position.z + direction.z * ZOMBIE_SPEED * delta;

                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–ª–∏–∑–∏–π
                if (!checkCollision(newX, newZ, 0.5)) {
                    zombie.position.x = newX;
                    zombie.position.z = newZ;
                }

                // –ü–æ–≤–æ—Ä–æ—Ç –∫ –∏–≥—Ä–æ–∫—É
                zombie.lookAt(playerPos.x, zombie.position.y, playerPos.z);

                // –ê–Ω–∏–º–∞—Ü–∏—è —Ö–æ–¥—å–±—ã
                const time = Date.now() * 0.005;
                zombie.children.forEach((part, i) => {
                    if (i >= 4) { // –ù–æ–≥–∏
                        part.rotation.x = Math.sin(time + i) * 0.3;
                    }
                });

                // –ê—Ç–∞–∫–∞ –∏–≥—Ä–æ–∫–∞
                const dist = zombie.position.distanceTo(playerPos);
                if (dist < 2) {
                    attackPlayer(zombie);
                }
            });
        }

        function attackPlayer(zombie) {
            if (!zombie.userData.lastAttack || Date.now() - zombie.userData.lastAttack > 1000) {
                zombie.userData.lastAttack = Date.now();

                let damage = ZOMBIE_DAMAGE;

                // –°–Ω–∞—á–∞–ª–∞ —É—Ä–æ–Ω –∏–¥—ë—Ç –ø–æ –±—Ä–æ–Ω–µ
                if (gameState.armorHealth > 0) {
                    gameState.armorHealth -= damage;

                    // –ï—Å–ª–∏ –±—Ä–æ–Ω—è —Å–ª–æ–º–∞–ª–∞—Å—å
                    if (gameState.armorHealth <= 0) {
                        // –û—Å—Ç–∞—Ç–æ–∫ —É—Ä–æ–Ω–∞ –∏–¥—ë—Ç –ø–æ –∑–¥–æ—Ä–æ–≤—å—é
                        const remainingDamage = Math.abs(gameState.armorHealth);
                        gameState.armorHealth = 0;
                        gameState.maxArmorHealth = 0;
                        gameState.armorType = 0;

                        // –°–±—Ä–æ—Å –±–æ–Ω—É—Å–∞ –∑–¥–æ—Ä–æ–≤—å—è –æ—Ç –±—Ä–æ–Ω–∏
                        gameState.maxHealth = 100;
                        if (gameState.health > gameState.maxHealth) {
                            gameState.health = gameState.maxHealth;
                        }

                        // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å—é —ç–∫–∏–ø–∏—Ä–æ–≤–∫—É –±—Ä–æ–Ω–∏
                        hideAllArmorGear();
                        showMessage('–ë—Ä–æ–Ω—è —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∞!');

                        // –ù–∞–Ω–æ—Å–∏–º –æ—Å—Ç–∞—Ç–æ–∫ —É—Ä–æ–Ω–∞ –ø–æ –∑–¥–æ—Ä–æ–≤—å—é
                        gameState.health -= remainingDamage;
                    }
                } else {
                    // –ï—Å–ª–∏ –±—Ä–æ–Ω–∏ –Ω–µ—Ç, —É—Ä–æ–Ω –∏–¥—ë—Ç –ø–æ –∑–¥–æ—Ä–æ–≤—å—é
                    gameState.health -= damage;
                }

                updateHUD();

                if (gameState.health <= 0) {
                    gameOver();
                }
            }
        }

        // ========== –°–¢–†–ï–õ–¨–ë–ê ==========
        function shoot() {
            if (gameState.shopOpen) return;

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ç—Ä–æ–Ω–æ–≤ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –æ—Ä—É–∂–∏—è
            if (gameState.currentWeapon === 'pistol') {
                if (gameState.ammo <= 0) {
                    showMessage('–ù–µ—Ç –ø–∞—Ç—Ä–æ–Ω–æ–≤ –¥–ª—è –ø–∏—Å—Ç–æ–ª–µ—Ç–∞!');
                    return;
                }
                gameState.ammo--;
            } else if (gameState.currentWeapon === 'shotgun') {
                if (gameState.shotgunAmmo <= 0) {
                    showMessage('–ù–µ—Ç –ø–∞—Ç—Ä–æ–Ω–æ–≤ –¥–ª—è –¥—Ä–æ–±–æ–≤–∏–∫–∞!');
                    return;
                }
                gameState.shotgunAmmo--;
            }

            updateHUD();

            // –°–æ–∑–¥–∞–Ω–∏–µ –ª—É—á–∞ –æ—Ç –∫–∞–º–µ—Ä—ã
            const raycaster = new THREE.Raycaster();
            raycaster.setFromCamera(new THREE.Vector2(0, 0), camera);

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ø–∞–¥–∞–Ω–∏—è –ø–æ –∑–æ–º–±–∏
            const zombieMeshes = [];
            zombies.forEach(zombie => {
                zombie.traverse(child => {
                    if (child.isMesh) {
                        child.userData.parentZombie = zombie;
                        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, —ç—Ç–æ –≥–æ–ª–æ–≤–∞ –∏–ª–∏ –Ω–µ—Ç (–ø–æ –ø–æ–∑–∏—Ü–∏–∏ Y)
                        const worldPos = new THREE.Vector3();
                        child.getWorldPosition(worldPos);
                        child.userData.isHead = (worldPos.y > zombie.position.y + 2.3);
                        zombieMeshes.push(child);
                    }
                });
            });

            const intersects = raycaster.intersectObjects(zombieMeshes);

            if (intersects.length > 0) {
                const hitMesh = intersects[0].object;
                const zombie = hitMesh.userData.parentZombie;
                const hitPoint = intersects[0].point;

                if (zombie && zombie.userData.health > 0) {
                    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —É—Ä–æ–Ω –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –æ—Ä—É–∂–∏—è
                    let damage = gameState.currentWeapon === 'pistol' ? 50 : 100;

                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ö–µ–¥—à–æ—Ç–∞ –¥–ª—è –¥—Ä–æ–±–æ–≤–∏–∫–∞
                    const isHeadshot = hitPoint.y > zombie.position.y + 2.3;

                    if (gameState.currentWeapon === 'shotgun' && isHeadshot) {
                        // –•–ï–î–®–û–¢ –î–†–û–ë–û–í–ò–ö–û–ú - –º–≥–Ω–æ–≤–µ–Ω–Ω–∞—è —Å–º–µ—Ä—Ç—å + –≤–∑—Ä—ã–≤ –≥–æ–ª–æ–≤—ã
                        zombie.userData.health = 0;
                        createHeadExplosion(zombie, hitPoint);
                        killZombieWithGore(zombie);
                    } else {
                        zombie.userData.health -= damage;
                        createHitEffect(hitPoint);

                        if (zombie.userData.health <= 0) {
                            killZombie(zombie);
                        }
                    }
                }
            }

            // –≠—Ñ—Ñ–µ–∫—Ç –≤—ã—Å—Ç—Ä–µ–ª–∞ (–≤—Å–ø—ã—à–∫–∞)
            createMuzzleFlash();
        }

        // –í–∑—Ä—ã–≤ –≥–æ–ª–æ–≤—ã –∑–æ–º–±–∏
        function createHeadExplosion(zombie, hitPoint) {
            const headPos = new THREE.Vector3(
                zombie.position.x,
                zombie.position.y + 2.75,
                zombie.position.z
            );

            // –°–∫—Ä—ã–≤–∞–µ–º –≥–æ–ª–æ–≤—É –∑–æ–º–±–∏
            zombie.children.forEach(child => {
                if (child.isMesh) {
                    const worldPos = new THREE.Vector3();
                    child.getWorldPosition(worldPos);
                    if (worldPos.y > zombie.position.y + 2.3) {
                        child.visible = false;
                    }
                }
            });

            // –°–æ–∑–¥–∞—ë–º –∫—É—Å–∫–∏ –≥–æ–ª–æ–≤—ã –∏ –º—è—Å–æ
            const meatColors = [0x8B0000, 0xA52A2A, 0x800000, 0x654321, 0x355E3B];

            for (let i = 0; i < 12; i++) {
                const size = 0.1 + Math.random() * 0.2;
                const geo = new THREE.BoxGeometry(size, size, size);
                const mat = new THREE.MeshStandardMaterial({
                    color: meatColors[Math.floor(Math.random() * meatColors.length)]
                });
                const chunk = new THREE.Mesh(geo, mat);

                chunk.position.copy(headPos);

                // –°–ª—É—á–∞–π–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å —Ä–∞–∑–ª—ë—Ç–∞
                chunk.userData.velocity = new THREE.Vector3(
                    (Math.random() - 0.5) * 8,
                    Math.random() * 5 + 2,
                    (Math.random() - 0.5) * 8
                );
                chunk.userData.rotSpeed = new THREE.Vector3(
                    Math.random() * 10,
                    Math.random() * 10,
                    Math.random() * 10
                );
                chunk.userData.lifetime = 5000; // 5 —Å–µ–∫—É–Ω–¥
                chunk.userData.birthTime = Date.now();

                chunk.castShadow = true;
                scene.add(chunk);
                goreObjects.push(chunk);
            }

            // –ö—Ä–æ–≤–∞–≤—ã–π —ç—Ñ—Ñ–µ–∫—Ç
            createBloodSplatter(headPos);
        }

        // –ö—Ä–æ–≤–∞–≤—ã–µ –±—Ä—ã–∑–≥–∏
        function createBloodSplatter(position) {
            for (let i = 0; i < 20; i++) {
                const geo = new THREE.SphereGeometry(0.05 + Math.random() * 0.08, 6, 6);
                const mat = new THREE.MeshStandardMaterial({ color: 0x8B0000 });
                const blood = new THREE.Mesh(geo, mat);

                blood.position.copy(position);
                blood.userData.velocity = new THREE.Vector3(
                    (Math.random() - 0.5) * 6,
                    Math.random() * 4,
                    (Math.random() - 0.5) * 6
                );
                blood.userData.lifetime = 3000;
                blood.userData.birthTime = Date.now();

                scene.add(blood);
                goreObjects.push(blood);
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ gore –æ–±—ä–µ–∫—Ç–æ–≤ (–∫—É—Å–∫–∏ –º—è—Å–∞ –ø–∞–¥–∞—é—Ç)
        function updateGore(delta) {
            for (let i = goreObjects.length - 1; i >= 0; i--) {
                const obj = goreObjects[i];

                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –∂–∏–∑–Ω–∏
                if (Date.now() - obj.userData.birthTime > obj.userData.lifetime) {
                    scene.remove(obj);
                    goreObjects.splice(i, 1);
                    continue;
                }

                // –ì—Ä–∞–≤–∏—Ç–∞—Ü–∏—è
                obj.userData.velocity.y -= 15 * delta;

                // –î–≤–∏–∂–µ–Ω–∏–µ
                obj.position.x += obj.userData.velocity.x * delta;
                obj.position.y += obj.userData.velocity.y * delta;
                obj.position.z += obj.userData.velocity.z * delta;

                // –í—Ä–∞—â–µ–Ω–∏–µ
                if (obj.userData.rotSpeed) {
                    obj.rotation.x += obj.userData.rotSpeed.x * delta;
                    obj.rotation.y += obj.userData.rotSpeed.y * delta;
                    obj.rotation.z += obj.userData.rotSpeed.z * delta;
                }

                // –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ –∑–µ–º–ª–µ
                if (obj.position.y < 0.1) {
                    obj.position.y = 0.1;
                    obj.userData.velocity.x *= 0.8;
                    obj.userData.velocity.z *= 0.8;
                    obj.userData.velocity.y = 0;
                    if (obj.userData.rotSpeed) {
                        obj.userData.rotSpeed.multiplyScalar(0.9);
                    }
                }
            }
        }

        function killZombie(zombie) {
            gameState.coins += 50;
            gameState.kills++;
            updateHUD();
            showMessage('+50 –º–æ–Ω–µ—Ç!');

            // –ü–æ–º–µ—á–∞–µ–º –∑–æ–º–±–∏ –∫–∞–∫ –º—ë—Ä—Ç–≤–æ–≥–æ
            zombie.userData.isDead = true;
            zombie.userData.deathTime = Date.now();

            // –£–±–∏—Ä–∞–µ–º –∏–∑ –º–∞—Å—Å–∏–≤–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–æ–º–±–∏
            const index = zombies.indexOf(zombie);
            if (index > -1) {
                zombies.splice(index, 1);
            }

            // –ê–Ω–∏–º–∞—Ü–∏—è –ø–∞–¥–µ–Ω–∏—è - –∑–æ–º–±–∏ –ø–∞–¥–∞–µ—Ç –Ω–∞ –∑–µ–º–ª—é
            zombieFallDown(zombie);
        }

        // –£–±–∏–π—Å—Ç–≤–æ –∑–æ–º–±–∏ —Å gore —ç—Ñ—Ñ–µ–∫—Ç–æ–º (—Ö–µ–¥—à–æ—Ç)
        function killZombieWithGore(zombie) {
            gameState.coins += 75; // –ë–æ–Ω—É—Å –∑–∞ —Ö–µ–¥—à–æ—Ç
            gameState.kills++;
            updateHUD();
            showMessage('+75 –º–æ–Ω–µ—Ç! –•–ï–î–®–û–¢!');

            // –ü–æ–º–µ—á–∞–µ–º –∑–æ–º–±–∏ –∫–∞–∫ –º—ë—Ä—Ç–≤–æ–≥–æ
            zombie.userData.isDead = true;
            zombie.userData.deathTime = Date.now();

            // –£–±–∏—Ä–∞–µ–º –∏–∑ –º–∞—Å—Å–∏–≤–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–æ–º–±–∏
            const index = zombies.indexOf(zombie);
            if (index > -1) {
                zombies.splice(index, 1);
            }

            // –ê–Ω–∏–º–∞—Ü–∏—è –ø–∞–¥–µ–Ω–∏—è
            zombieFallDown(zombie);
        }

        // –ú–∞—Å—Å–∏–≤ –º—ë—Ä—Ç–≤—ã—Ö –∑–æ–º–±–∏ (—Ç–µ–ª–∞)
        let deadZombies = [];

        // –ê–Ω–∏–º–∞—Ü–∏—è –ø–∞–¥–µ–Ω–∏—è –∑–æ–º–±–∏
        function zombieFallDown(zombie) {
            // –ù–∞–∫–ª–æ–Ω—è–µ–º –∑–æ–º–±–∏ (–ø–∞–¥–∞–µ—Ç –Ω–∞–∑–∞–¥)
            zombie.rotation.x = -Math.PI / 2;
            zombie.position.y = 0.5;

            // –î–æ–±–∞–≤–ª—è–µ–º –≤ –º–∞—Å—Å–∏–≤ –º—ë—Ä—Ç–≤—ã—Ö —Ç–µ–ª
            deadZombies.push(zombie);
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º—ë—Ä—Ç–≤—ã—Ö –∑–æ–º–±–∏ (—É–¥–∞–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥)
        function updateDeadZombies() {
            for (let i = deadZombies.length - 1; i >= 0; i--) {
                const zombie = deadZombies[i];

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Ä–µ–º—è —Å–º–µ—Ä—Ç–∏
                if (Date.now() - zombie.userData.deathTime > 5000) {
                    scene.remove(zombie);
                    deadZombies.splice(i, 1);
                }
            }
        }

        function createHitEffect(position) {
            const geo = new THREE.SphereGeometry(0.2, 8, 8);
            const mat = new THREE.MeshBasicMaterial({ color: 0xff0000 });
            const effect = new THREE.Mesh(geo, mat);
            effect.position.copy(position);
            scene.add(effect);

            setTimeout(() => scene.remove(effect), 100);
        }

        function createMuzzleFlash() {
            const flash = new THREE.PointLight(0xffaa00, 3, 5);
            flash.position.copy(player.position);
            flash.position.y += 1;
            scene.add(flash);

            setTimeout(() => scene.remove(flash), 50);
        }

        // ========== –ö–û–õ–õ–ò–ó–ò–ò ==========
        function checkCollision(x, z, radius = 0.6) {
            for (const building of buildings) {
                if (x + radius > building.minX &&
                    x - radius < building.maxX &&
                    z + radius > building.minZ &&
                    z - radius < building.maxZ) {
                    return true;
                }
            }

            // –ì—Ä–∞–Ω–∏—Ü—ã –∫–∞—Ä—Ç—ã
            if (Math.abs(x) > 95 || Math.abs(z) > 95) {
                return true;
            }

            return false;
        }

        // ========== –ú–ê–ì–ê–ó–ò–ù ==========
        function buyItem(item) {
            const prices = {
                shotgun: 50,
                armor1: 50,
                armor2: 100,
                armor3: 500,
                ammo: 14,
                shotgunAmmo: 20
            };

            if (gameState.coins < prices[item]) {
                showMessage('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!');
                return;
            }

            gameState.coins -= prices[item];

            switch(item) {
                case 'shotgun':
                    if (gameState.hasShotgun) {
                        // –ï—Å–ª–∏ —É–∂–µ –µ—Å—Ç—å - –ø—Ä–æ—Å—Ç–æ –ø–æ–ø–æ–ª–Ω—è–µ–º –ø–∞—Ç—Ä–æ–Ω—ã
                        gameState.shotgunAmmo = gameState.maxShotgunAmmo;
                        showMessage('–ü–∞—Ç—Ä–æ–Ω—ã –¥—Ä–æ–±–æ–≤–∏–∫–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω—ã!');
                    } else {
                        gameState.hasShotgun = true;
                        gameState.shotgunAmmo = gameState.maxShotgunAmmo;
                        updateShotgunUI();
                        showMessage('–î—Ä–æ–±–æ–≤–∏–∫ –∫—É–ø–ª–µ–Ω! –ù–∞–∂–º–∏—Ç–µ 2 –¥–ª—è –≤—ã–±–æ—Ä–∞');
                    }
                    break;
                case 'armor1':
                    // –°–∫—Ä—ã–≤–∞–µ–º —Å—Ç–∞—Ä—É—é —ç–∫–∏–ø–∏—Ä–æ–≤–∫—É —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ –±—Ä–æ–Ω–∏
                    hideAllArmorGear();
                    gameState.armorType = 1;
                    gameState.armorHealth = 25;
                    gameState.maxArmorHealth = 25;
                    // –ë–æ–Ω—É—Å –∫ –∑–¥–æ—Ä–æ–≤—å—é: +25 HP
                    gameState.maxHealth = 125;
                    gameState.health = Math.min(gameState.health + 25, gameState.maxHealth);
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–∞–º—É—Ñ–ª—è–∂ –Ω–∞ —Ç–æ—Ä—Å–µ, —Ä—É–∫–∞—Ö –∏ –Ω–æ–≥–∞—Ö
                    playerBody.camouflage.visible = true;
                    showMessage('–ö–∞–º—É—Ñ–ª—è–∂ —ç–∫–∏–ø–∏—Ä–æ–≤–∞–Ω!');
                    break;
                case 'armor2':
                    hideAllArmorGear();
                    gameState.armorType = 2;
                    gameState.armorHealth = 50;
                    gameState.maxArmorHealth = 50;
                    // –ë–æ–Ω—É—Å –∫ –∑–¥–æ—Ä–æ–≤—å—é: +50 HP
                    gameState.maxHealth = 150;
                    gameState.health = Math.min(gameState.health + 50, gameState.maxHealth);
                    // –ö–∞–º—É—Ñ–ª—è–∂ + —Ç–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –∂–∏–ª–µ—Ç (—Ä–∞–∑–≥—Ä—É–∑–∫–∞)
                    playerBody.camouflage.visible = true;
                    playerBody.tacticalVest.visible = true;
                    showMessage('–ñ–∏–ª–µ—Ç —ç–∫–∏–ø–∏—Ä–æ–≤–∞–Ω!');
                    break;
                case 'armor3':
                    hideAllArmorGear();
                    gameState.armorType = 3;
                    gameState.armorHealth = 100;
                    gameState.maxArmorHealth = 100;
                    // –ë–æ–Ω—É—Å –∫ –∑–¥–æ—Ä–æ–≤—å—é: +100 HP
                    gameState.maxHealth = 200;
                    gameState.health = Math.min(gameState.health + 100, gameState.maxHealth);
                    // –ö–∞–º—É—Ñ–ª—è–∂ + —Ç—è–∂—ë–ª—ã–π –±—Ä–æ–Ω–µ–∂–∏–ª–µ—Ç + –≤–æ–µ–Ω–Ω—ã–π —à–ª–µ–º
                    playerBody.camouflage.visible = true;
                    playerBody.heavyVest.visible = true;
                    playerBody.militaryHelmet.visible = true;
                    showMessage('–®—Ç—É—Ä–º–æ–≤–æ–π –∫–æ–º–ø–ª–µ–∫—Ç —ç–∫–∏–ø–∏—Ä–æ–≤–∞–Ω!');
                    break;
                case 'ammo':
                    gameState.ammo = gameState.maxAmmo;
                    showMessage('–ü–∞—Ç—Ä–æ–Ω—ã –ø–∏—Å—Ç–æ–ª–µ—Ç–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω—ã!');
                    break;
                case 'shotgunAmmo':
                    if (!gameState.hasShotgun) {
                        showMessage('–°–Ω–∞—á–∞–ª–∞ –∫—É–ø–∏—Ç–µ –¥—Ä–æ–±–æ–≤–∏–∫!');
                        gameState.coins += prices[item]; // –í–æ–∑–≤—Ä–∞—Ç –º–æ–Ω–µ—Ç
                        return;
                    }
                    gameState.shotgunAmmo = gameState.maxShotgunAmmo;
                    showMessage('–ü–∞—Ç—Ä–æ–Ω—ã –¥—Ä–æ–±–æ–≤–∏–∫–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω—ã!');
                    break;
            }

            updateHUD();
        }

        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ü–≤–µ—Ç–∞ –±—Ä–æ–Ω–µ–∂–∏–ª–µ—Ç–∞
        function setVestColor(color) {
            playerBody.vest.children.forEach((child, index) => {
                if (child.isMesh && index === 0) {
                    // –û—Å–Ω–æ–≤–∞ –∂–∏–ª–µ—Ç–∞
                    child.material.color.setHex(color);
                } else if (child.isMesh && index >= 1 && index <= 4) {
                    // –ö–∞—Ä–º–∞–Ω—ã (—á—É—Ç—å —Ç–µ–º–Ω–µ–µ)
                    child.material.color.setHex(color - 0x111111);
                }
            });
        }

        // –°–∫—Ä—ã—Ç—å –≤—Å—é —ç–∫–∏–ø–∏—Ä–æ–≤–∫—É –±—Ä–æ–Ω–∏
        function hideAllArmorGear() {
            // –°—Ç–∞—Ä–∞—è —ç–∫–∏–ø–∏—Ä–æ–≤–∫–∞ (SWAT)
            playerBody.vest.visible = false;
            playerBody.helmet.visible = false;
            playerBody.balaclava.visible = false;
            playerBody.leftKneePad.visible = false;
            playerBody.rightKneePad.visible = false;
            // –ù–æ–≤–∞—è —ç–∫–∏–ø–∏—Ä–æ–≤–∫–∞ (–≤–æ–µ–Ω–Ω–∞—è)
            playerBody.camouflage.visible = false;
            playerBody.tacticalVest.visible = false;
            playerBody.heavyVest.visible = false;
            playerBody.militaryHelmet.visible = false;
        }

        // –î–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
        function hideHeavyArmorGear() {
            hideAllArmorGear();
        }

        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ü–≤–µ—Ç–∞ —ç–∫–∏–ø–∏—Ä–æ–≤–∫–∏ —Ç—è–∂—ë–ª–æ–π –±—Ä–æ–Ω–∏
        function setHeavyArmorColor(color) {
            // –¶–≤–µ—Ç —à–ª–µ–º–∞
            playerBody.helmet.children.forEach((child, index) => {
                if (child.isMesh && index <= 1) {
                    child.material.color.setHex(color);
                }
            });
            // –¶–≤–µ—Ç –Ω–∞–∫–æ–ª–µ–Ω–Ω–∏–∫–æ–≤
            playerBody.leftKneePad.children[0].material.color.setHex(color);
            playerBody.rightKneePad.children[0].material.color.setHex(color);
        }

        function toggleShop() {
            gameState.shopOpen = !gameState.shopOpen;
            document.getElementById('shop').classList.toggle('visible', gameState.shopOpen);
        }

        // ========== HUD ==========
        function updateHUD() {
            document.getElementById('coinsValue').textContent = gameState.coins;
            document.getElementById('killsValue').textContent = gameState.kills;

            // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–∞—Ç—Ä–æ–Ω–æ–≤ —Ç–µ–∫—É—â–µ–≥–æ –æ—Ä—É–∂–∏—è
            let ammoText = '';
            if (gameState.currentWeapon === 'pistol') {
                ammoText = `üî´ ${gameState.ammo}/${gameState.maxAmmo}`;
            } else if (gameState.currentWeapon === 'shotgun') {
                ammoText = `üí• ${gameState.shotgunAmmo}/${gameState.maxShotgunAmmo}`;
            }
            document.getElementById('ammoValue').textContent = ammoText;

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª–æ—Å–∫–∏ –∑–¥–æ—Ä–æ–≤—å—è
            const healthPercent = (gameState.health / gameState.maxHealth) * 100;
            document.getElementById('healthFill').style.width = Math.max(0, healthPercent) + '%';
            document.getElementById('healthValue').textContent = Math.max(0, Math.round(gameState.health));

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª–æ—Å–∫–∏ –±—Ä–æ–Ω–∏
            const armorBar = document.getElementById('armorBar');
            if (gameState.armorHealth > 0) {
                armorBar.style.display = 'flex';
                const armorPercent = (gameState.armorHealth / gameState.maxArmorHealth) * 100;
                document.getElementById('armorFill').style.width = armorPercent + '%';
                document.getElementById('armorValue').textContent = Math.round(gameState.armorHealth);
            } else {
                armorBar.style.display = 'none';
            }
        }

        function showMessage(text) {
            const msg = document.getElementById('message');
            msg.textContent = text;
            msg.classList.remove('visible');
            void msg.offsetWidth; // Trigger reflow
            msg.classList.add('visible');
        }

        // ========== –°–û–ë–´–¢–ò–Ø ==========
        function setupEventListeners() {
            // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —É–∫–∞–∑–∞—Ç–µ–ª—è
            document.getElementById('startBtn').addEventListener('click', () => {
                document.body.requestPointerLock();
            });

            document.addEventListener('pointerlockchange', () => {
                if (document.pointerLockElement) {
                    document.getElementById('lockScreen').style.display = 'none';
                    gameState.isPlaying = true;
                } else {
                    if (!gameState.shopOpen && gameState.health > 0) {
                        document.getElementById('lockScreen').style.display = 'flex';
                    }
                    gameState.isPlaying = false;
                }
            });

            // –î–≤–∏–∂–µ–Ω–∏–µ –º—ã—à–∏
            document.addEventListener('mousemove', (e) => {
                if (!document.pointerLockElement || gameState.shopOpen) return;

                playerRotationY -= e.movementX * 0.002;
                cameraPitch -= e.movementY * 0.002;
                cameraPitch = Math.max(-Math.PI / 3, Math.min(Math.PI / 3, cameraPitch));
            });

            // –ö–ª–∞–≤–∏—à–∏ (WASD + —Å—Ç—Ä–µ–ª–∫–∏)
            document.addEventListener('keydown', (e) => {
                const key = e.key.toLowerCase();
                if (key in keys) keys[key] = true;
                if (key === ' ') {
                    keys.space = true;
                    e.preventDefault();
                }
                // –°—Ç—Ä–µ–ª–∫–∏
                if (e.key === 'ArrowUp') { keys.arrowup = true; e.preventDefault(); }
                if (e.key === 'ArrowDown') { keys.arrowdown = true; e.preventDefault(); }
                if (e.key === 'ArrowLeft') { keys.arrowleft = true; e.preventDefault(); }
                if (e.key === 'ArrowRight') { keys.arrowright = true; e.preventDefault(); }

                if (key === 'b') {
                    toggleShop();
                }
                // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∫–∞–º–µ—Ä—ã (V) - —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –∏–≥—Ä–∞ –∑–∞–ø—É—â–µ–Ω–∞
                if (key === 'v' && gameState.isPlaying && !gameState.shopOpen) {
                    toggleCameraMode();
                }
                // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –æ—Ä—É–∂–∏—è (1 - –ø–∏—Å—Ç–æ–ª–µ—Ç, 2 - –¥—Ä–æ–±–æ–≤–∏–∫)
                if (e.key === '1' && gameState.isPlaying && !gameState.shopOpen) {
                    switchWeapon('pistol');
                }
                if (e.key === '2' && gameState.isPlaying && !gameState.shopOpen) {
                    switchWeapon('shotgun');
                }
                if (e.key === 'Escape' && gameState.shopOpen) {
                    toggleShop();
                }
            });

            document.addEventListener('keyup', (e) => {
                const key = e.key.toLowerCase();
                if (key in keys) keys[key] = false;
                if (key === ' ') keys.space = false;
                // –°—Ç—Ä–µ–ª–∫–∏
                if (e.key === 'ArrowUp') keys.arrowup = false;
                if (e.key === 'ArrowDown') keys.arrowdown = false;
                if (e.key === 'ArrowLeft') keys.arrowleft = false;
                if (e.key === 'ArrowRight') keys.arrowright = false;
            });

            // –°—Ç—Ä–µ–ª—å–±–∞
            document.addEventListener('mousedown', (e) => {
                if (e.button === 0 && document.pointerLockElement && !gameState.shopOpen) {
                    shoot();
                }
            });

            // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–∞–≥–∞–∑–∏–Ω–∞
            document.getElementById('shop-close').addEventListener('click', toggleShop);

            // –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });
        }

        // ========== –î–í–ò–ñ–ï–ù–ò–ï –ò–ì–†–û–ö–ê ==========
        function updatePlayer(delta) {
            if (!gameState.isPlaying || gameState.shopOpen) return;

            // –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏—è (WASD + —Å—Ç—Ä–µ–ª–∫–∏)
            const moveDirection = new THREE.Vector3();

            if (keys.w || keys.arrowup) moveDirection.z -= 1;
            if (keys.s || keys.arrowdown) moveDirection.z += 1;
            if (keys.a || keys.arrowleft) moveDirection.x -= 1;
            if (keys.d || keys.arrowright) moveDirection.x += 1;

            moveDirection.normalize();

            // –ü—Ä–∏–º–µ–Ω—è–µ–º –ø–æ–≤–æ—Ä–æ—Ç –∏–≥—Ä–æ–∫–∞
            const rotatedDirection = moveDirection.clone();
            rotatedDirection.applyAxisAngle(new THREE.Vector3(0, 1, 0), playerRotationY);

            // –ù–æ–≤–∞—è –ø–æ–∑–∏—Ü–∏—è
            const newX = player.position.x + rotatedDirection.x * PLAYER_SPEED * delta;
            const newZ = player.position.z + rotatedDirection.z * PLAYER_SPEED * delta;

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–ª–∏–∑–∏–π –ø–æ X –∏ Z –æ—Ç–¥–µ–ª—å–Ω–æ
            if (!checkCollision(newX, player.position.z)) {
                player.position.x = newX;
            }
            if (!checkCollision(player.position.x, newZ)) {
                player.position.z = newZ;
            }

            // –ü—Ä—ã–∂–æ–∫
            if (keys.space && isGrounded) {
                playerVelocityY = JUMP_FORCE;
                isGrounded = false;
            }

            // –ì—Ä–∞–≤–∏—Ç–∞—Ü–∏—è
            playerVelocityY += GRAVITY * delta;
            player.position.y += playerVelocityY * delta;

            // –ò–≥—Ä–æ–∫ –ø—Ä–∏–∑–µ–º–ª—è–µ—Ç—Å—è –Ω–∞ –∑–µ–º–ª—é (y=0)
            if (player.position.y <= 0) {
                player.position.y = 0;
                playerVelocityY = 0;
                isGrounded = true;
            }

            // –ü–æ–≤–æ—Ä–æ—Ç –∏–≥—Ä–æ–∫–∞
            player.rotation.y = playerRotationY;

            // –ê–Ω–∏–º–∞—Ü–∏—è —Ö–æ–¥—å–±—ã
            // –ë–∞–∑–æ–≤–∞—è –ø–æ–∑–∏—Ü–∏—è —Ä—É–∫–∏ —Å –ø–∏—Å—Ç–æ–ª–µ—Ç–æ–º - –≤—ã—Ç—è–Ω—É—Ç–∞ –í–ü–ï–†–Å–î –¥–ª—è –ø—Ä–∏—Ü–µ–ª–∏–≤–∞–Ω–∏—è
            const gunArmBaseRotation = Math.PI / 2.5; // –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–π = –≤–ø–µ—Ä—ë–¥

            if (moveDirection.length() > 0) {
                const walkSpeed = 10;
                const time = Date.now() * 0.001 * walkSpeed;
                playerBody.leftLeg.rotation.x = Math.sin(time) * 0.5;
                playerBody.rightLeg.rotation.x = Math.sin(time + Math.PI) * 0.5;
                playerBody.leftArm.rotation.x = Math.sin(time + Math.PI) * 0.3;
                // –ü—Ä–∞–≤–∞—è —Ä—É–∫–∞ —Å –ø–∏—Å—Ç–æ–ª–µ—Ç–æ–º –≤–ø–µ—Ä—ë–¥ + –Ω–µ–±–æ–ª—å—à–æ–µ –ø–æ–∫–∞—á–∏–≤–∞–Ω–∏–µ
                playerBody.rightArmGroup.rotation.x = gunArmBaseRotation + Math.sin(time) * 0.05;
            } else {
                playerBody.leftLeg.rotation.x = 0;
                playerBody.rightLeg.rotation.x = 0;
                playerBody.leftArm.rotation.x = 0;
                // –ü—Ä–∞–≤–∞—è —Ä—É–∫–∞ —Å –ø–∏—Å—Ç–æ–ª–µ—Ç–æ–º –≤—Å–µ–≥–¥–∞ –≤—ã—Ç—è–Ω—É—Ç–∞ –≤–ø–µ—Ä—ë–¥
                playerBody.rightArmGroup.rotation.x = gunArmBaseRotation;
            }
        }

        // ========== –ö–ê–ú–ï–†–ê ==========
        function updateCamera() {
            if (cameraMode === 'third') {
                // ===== –í–ò–î –û–¢ –¢–†–ï–¢–¨–ï–ì–û –õ–ò–¶–ê =====
                const cameraDistance = 6;
                const cameraHeight = 4;

                const offsetX = Math.sin(playerRotationY) * cameraDistance;
                const offsetZ = Math.cos(playerRotationY) * cameraDistance;

                camera.position.x = player.position.x + offsetX;
                camera.position.z = player.position.z + offsetZ;
                camera.position.y = player.position.y + cameraHeight + Math.sin(cameraPitch) * 2;

                // –ö–∞–º–µ—Ä–∞ —Å–º–æ—Ç—Ä–∏—Ç –Ω–∞ —Ü–µ–Ω—Ç—Ä –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
                const lookAtY = player.position.y + 2 + cameraPitch * 2;
                camera.lookAt(player.position.x, lookAtY, player.position.z);

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–≥—Ä–æ–∫–∞, —Å–∫—Ä—ã–≤–∞–µ–º FPS –ø–∏—Å—Ç–æ–ª–µ—Ç
                player.visible = true;
                playerBody.fpsGun.visible = false;

            } else {
                // ===== –í–ò–î –û–¢ –ü–ï–†–í–û–ì–û –õ–ò–¶–ê =====
                // –ö–∞–º–µ—Ä–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ –≥–ª–∞–∑ –∏–≥—Ä–æ–∫–∞
                const eyeHeight = 2.8;
                camera.position.x = player.position.x;
                camera.position.z = player.position.z;
                camera.position.y = player.position.y + eyeHeight;

                // –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∑–≥–ª—è–¥–∞
                const lookDistance = 10;
                const lookX = player.position.x - Math.sin(playerRotationY) * lookDistance;
                const lookZ = player.position.z - Math.cos(playerRotationY) * lookDistance;
                const lookY = player.position.y + eyeHeight + cameraPitch * 5;
                camera.lookAt(lookX, lookY, lookZ);

                // –°–∫—Ä—ã–≤–∞–µ–º –∏–≥—Ä–æ–∫–∞ (–∫—Ä–æ–º–µ —Ä—É–∫), –ø–æ–∫–∞–∑—ã–≤–∞–µ–º FPS –ø–∏—Å—Ç–æ–ª–µ—Ç
                player.visible = false;

                // –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ–º –ø–∏—Å—Ç–æ–ª–µ—Ç –¥–ª—è FPS –≤–∏–¥–∞ (–≤ –ø—Ä–∞–≤–æ–º –Ω–∏–∂–Ω–µ–º —É–≥–ª—É —ç–∫—Ä–∞–Ω–∞)
                playerBody.fpsGun.visible = true;
                const gunOffset = new THREE.Vector3(0.4, -0.3, -0.8);
                gunOffset.applyAxisAngle(new THREE.Vector3(0, 1, 0), -playerRotationY);
                playerBody.fpsGun.position.set(
                    camera.position.x + gunOffset.x,
                    camera.position.y + gunOffset.y + cameraPitch * 0.3,
                    camera.position.z + gunOffset.z
                );
                playerBody.fpsGun.rotation.set(cameraPitch * 0.5, -playerRotationY + Math.PI, 0);
            }
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ –∫–∞–º–µ—Ä—ã
        function toggleCameraMode() {
            if (cameraMode === 'third') {
                cameraMode = 'first';
                showMessage('–í–∏–¥ –æ—Ç –ø–µ—Ä–≤–æ–≥–æ –ª–∏—Ü–∞ (V - –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å)');
            } else {
                cameraMode = 'third';
                showMessage('–í–∏–¥ –æ—Ç —Ç—Ä–µ—Ç—å–µ–≥–æ –ª–∏—Ü–∞ (V - –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å)');
            }
        }

        // ========== GAME OVER ==========
        function gameOver() {
            gameState.isPlaying = false;
            document.exitPointerLock();
            document.getElementById('finalKills').textContent = gameState.kills;
            document.getElementById('gameOver').classList.add('visible');
        }

        function restartGame() {
            // –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è
            gameState = {
                coins: 0,
                ammo: 12,
                maxAmmo: 12,
                shotgunAmmo: 0,
                maxShotgunAmmo: 6,
                currentWeapon: 'pistol',
                hasShotgun: false,
                kills: 0,
                health: 100,
                maxHealth: 100,
                armorHealth: 0,
                maxArmorHealth: 0,
                armorType: 0,
                isPlaying: false,
                shopOpen: false
            };

            // –û—á–∏—Å—Ç–∫–∞ gore –æ–±—ä–µ–∫—Ç–æ–≤
            goreObjects.forEach(obj => scene.remove(obj));
            goreObjects = [];

            // –°–±—Ä–æ—Å –æ—Ä—É–∂–∏—è
            playerBody.gun.visible = true;
            playerBody.shotgun.visible = false;
            updateShotgunUI();

            // –°–±—Ä–æ—Å UI –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
            document.getElementById('slot1').classList.add('active');
            document.getElementById('slot2').classList.remove('active');

            // –£–¥–∞–ª–µ–Ω–∏–µ –∑–æ–º–±–∏
            zombies.forEach(z => scene.remove(z));
            zombies = [];

            // –£–¥–∞–ª–µ–Ω–∏–µ –º—ë—Ä—Ç–≤—ã—Ö –∑–æ–º–±–∏
            deadZombies.forEach(z => scene.remove(z));
            deadZombies = [];

            // –°–±—Ä–æ—Å –ø–æ–∑–∏—Ü–∏–∏ –∏–≥—Ä–æ–∫–∞ (–Ω–∞ –∑–µ–º–ª—é y=0)
            player.position.set(0, 0, 0);
            player.visible = true;
            playerRotationY = 0;
            cameraPitch = 0;
            cameraMode = 'third'; // –°–±—Ä–æ—Å –Ω–∞ –≤–∏–¥ –æ—Ç —Ç—Ä–µ—Ç—å–µ–≥–æ –ª–∏—Ü–∞
            playerBody.fpsGun.visible = false;

            // –°–±—Ä–æ—Å –±—Ä–æ–Ω–∏ - —Å–∫—Ä—ã–≤–∞–µ–º –≤—Å—é —ç–∫–∏–ø–∏—Ä–æ–≤–∫—É
            hideAllArmorGear();
            setVestColor(0x2a2a2a); // –°–±—Ä–æ—Å —Ü–≤–µ—Ç–∞ –∂–∏–ª–µ—Ç–∞

            // UI
            document.getElementById('gameOver').classList.remove('visible');
            document.getElementById('lockScreen').style.display = 'flex';
            updateHUD();
        }

        // ========== –ì–õ–ê–í–ù–´–ô –¶–ò–ö–õ ==========
        function animate() {
            requestAnimationFrame(animate);

            const delta = clock.getDelta();

            updatePlayer(delta);
            updateCamera();
            updateZombies(delta);
            updateDeadZombies();
            updateGore(delta);

            renderer.render(scene, camera);
        }

        // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã
        init();
    </script>
</body>
</html>
